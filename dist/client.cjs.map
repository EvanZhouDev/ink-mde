{"version":3,"file":"client.cjs","sources":["../src/constants.ts","../src/api/destroy.ts","../src/api/focus.ts","../src/vendor/adapters/selections.ts","../types/values.ts","../src/api/format.ts","../src/api/get_doc.ts","../src/api/selections.ts","../src/api/insert.ts","../src/utils/merge.ts","../src/utils/inspect.ts","../src/utils/options.ts","../src/markdown.ts","../src/ui/utils.ts","../src/vendor/extensions/appearance.ts","../src/extensions.ts","../src/vendor/extensions/blockquote.ts","../src/vendor/extensions/code.ts","../src/vendor/extensions/ink.ts","../src/vendor/extensions/line_wrapping.ts","../src/vendor/extensions/theme.ts","../src/vendor/state.ts","../src/api/load.ts","../src/api/options.ts","../src/api/reconfigure.ts","../src/api/select.ts","../src/api/update.ts","../src/api/wrap.ts","../src/utils/awaitable.ts","../src/instance.ts","../lib/codemirror-kit/decorations.ts","../lib/codemirror-kit/parsers.ts","../lib/codemirror-kit/markdown.ts","../src/modules.ts","../plugins/katex/grammar.ts","../plugins/katex/index.ts","../src/utils/queue.ts","../src/store.ts","../src/utils/readability.ts","../src/ui/components/details/index.tsx","../src/ui/components/drop_zone/index.tsx","../src/vendor/editor.ts","../src/ui/components/editor/index.tsx","../src/ui/components/button/index.tsx","../src/ui/components/toolbar/index.tsx","../src/ui/components/root/styles.tsx","../src/ui/components/root/index.tsx","../src/ui/app.tsx","../src/index.tsx","../src/vendor/extensions/autocomplete.ts","../src/vendor/extensions/images.ts","../src/vendor/extensions/indentWithTab.ts","../src/vendor/extensions/lists.ts","../src/vendor/extensions/readonly.ts","../src/vendor/extensions/search.tsx","../src/vendor/extensions/spellcheck.ts","../src/importers/katex.ts"],"sourcesContent":["export const HYDRATION_MARKER = 'data-ink-mde-ssr-hydration-marker'\nexport const HYDRATION_MARKER_SELECTOR = `[${HYDRATION_MARKER}]`\n\nexport const getHydrationMarkerProps = () => {\n  if (import.meta.env.VITE_SSR) {\n    return {\n      [HYDRATION_MARKER]: true,\n    }\n  }\n\n  return {}\n}\n","import type InkInternal from '/types/internal'\n\nexport const destroy = ([state]: InkInternal.Store) => {\n  const { editor } = state()\n\n  editor.destroy()\n}\n","import type InkInternal from '/types/internal'\n\nexport const focus = ([state]: InkInternal.Store) => {\n  const { editor } = state()\n\n  if (!editor.hasFocus) {\n    editor.focus()\n  }\n}\n","import { EditorSelection, SelectionRange } from '@codemirror/state'\nimport type * as Ink from '/types/ink'\n\nexport const toCodeMirror = (selections: Ink.Editor.Selection[]) => {\n  const ranges = selections.map((selection): SelectionRange => {\n    const range = SelectionRange.fromJSON({ anchor: selection.start, head: selection.end })\n\n    return range\n  })\n\n  return EditorSelection.create(ranges)\n}\n\nexport const toInk = (selection: EditorSelection) => {\n  const selections = selection.ranges.map((range: SelectionRange): Ink.Editor.Selection => {\n    return {\n      end: range.anchor < range.head ? range.head : range.anchor,\n      start: range.head < range.anchor ? range.head : range.anchor,\n    }\n  })\n\n  return selections\n}\n","export enum Appearance {\n  Auto = 'auto',\n  Dark = 'dark',\n  Light = 'light',\n}\n\nexport enum Extensions {\n  Appearance = 'appearance',\n  Attribution = 'attribution',\n  Autocomplete = 'autocomplete',\n  Images = 'images',\n  ReadOnly = 'readonly',\n  Spellcheck = 'spellcheck',\n  Vim = 'vim',\n}\n\nexport enum Markup {\n  Bold = 'bold',\n  Code = 'code',\n  CodeBlock = 'code_block',\n  Heading = 'heading',\n  Image = 'image',\n  Italic = 'italic',\n  Link = 'link',\n  List = 'list',\n  OrderedList = 'ordered_list',\n  Quote = 'quote',\n  TaskList = 'task_list',\n}\n\nexport enum PluginType {\n  Completion = 'completion',\n  Default = 'default',\n  Grammar = 'grammar',\n  Language = 'language',\n}\n\nexport enum Selection {\n  End = 'end',\n  Start = 'start',\n}\n\nexport const appearanceTypes = {\n  auto: 'auto',\n  dark: 'dark',\n  light: 'light',\n}\n\nexport const pluginTypes = {\n  completion: 'completion',\n  default: 'default',\n  grammar: 'grammar',\n  language: 'language',\n} as const\n","import { syntaxTree } from '@codemirror/language'\nimport type { NodeType } from '@lezer/common'\nimport { toInk } from '/src/vendor/adapters/selections'\nimport type * as Ink from '/types/ink'\nimport type InkInternal from '/types/internal'\nimport * as InkValues from '/types/values'\n\n// Todo:\n// - [ ] Handle special scenarios (e.g. headings in quote blocks).\n// - [ ] Handle multiline selections (e.g. bolding multiple lines worth of content).\n\ninterface ChangeDetails {\n  editor: InkInternal.Editor,\n  formatDefinition: FormatDefinition,\n  selection: Ink.Editor.Selection,\n  node?: NodeDefinition,\n}\n\ninterface FormatDefinition {\n  block: boolean,\n  line: boolean,\n  multiline: boolean,\n  nodes: string[],\n  prefix: string,\n  prefixStates: string[],\n  suffix: string,\n}\n\ntype Formats = {\n  [K in Ink.Values.Markup]: FormatDefinition\n}\n\ninterface NodeDefinition {\n  type: NodeType,\n  from: number,\n  to: number,\n}\n\nconst defineConfig = (overrides: Partial<FormatDefinition>): FormatDefinition => {\n  const defaults = {\n    block: false,\n    line: false,\n    multiline: false,\n    nodes: [],\n    prefix: '',\n    prefixStates: [],\n    suffix: '',\n  }\n\n  return { ...defaults, ...overrides }\n}\n\nexport const formatting: Formats = {\n  [InkValues.Markup.Bold]: defineConfig({\n    nodes: ['StrongEmphasis'],\n    prefix: '**',\n    suffix: '**',\n  }),\n  [InkValues.Markup.Code]: defineConfig({\n    nodes: ['InlineCode'],\n    prefix: '`',\n    suffix: '`',\n  }),\n  [InkValues.Markup.CodeBlock]: defineConfig({\n    block: true,\n    nodes: ['FencedCode'],\n    prefix: '```\\n',\n    suffix: '\\n```',\n  }),\n  [InkValues.Markup.Heading]: defineConfig({\n    multiline: true,\n    nodes: ['ATXHeading1', 'ATXHeading2', 'ATXHeading3', 'ATXHeading4', 'ATXHeading5', 'ATXHeading6'],\n    prefix: '# ',\n    prefixStates: ['# ', '## ', '### ', '#### ', '##### ', '###### ', ''],\n  }),\n  [InkValues.Markup.Image]: defineConfig({\n    nodes: ['Image'],\n    prefix: '![](',\n    suffix: ')',\n  }),\n  [InkValues.Markup.Italic]: defineConfig({\n    nodes: ['Emphasis'],\n    prefix: '*',\n    suffix: '*',\n  }),\n  [InkValues.Markup.Link]: defineConfig({\n    nodes: ['Link'],\n    prefix: '[](',\n    suffix: ')',\n  }),\n  [InkValues.Markup.OrderedList]: defineConfig({\n    line: true,\n    multiline: true,\n    nodes: ['OrderedList'],\n    prefix: '1. ',\n  }),\n  [InkValues.Markup.Quote]: defineConfig({\n    line: true,\n    multiline: true,\n    nodes: ['Blockquote'],\n    prefix: '> ',\n  }),\n  [InkValues.Markup.TaskList]: defineConfig({\n    line: true,\n    multiline: true,\n    nodes: ['BulletList'],\n    prefix: '- [ ] ',\n  }),\n  [InkValues.Markup.List]: defineConfig({\n    line: true,\n    multiline: true,\n    nodes: ['BulletList'],\n    prefix: '- ',\n  }),\n}\n\nconst splitSelectionByLines = ({ editor, selection }: ChangeDetails) => {\n  let position = selection.start\n  const selections: Ink.Editor.Selection[] = []\n\n  while (position <= selection.end) {\n    const line = editor.lineBlockAt(position)\n    const start = Math.max(selection.start, line.from)\n    const end = Math.min(selection.end, line.to)\n\n    selections.push({ start, end })\n\n    position = line.to + 1\n  }\n\n  return selections\n}\n\nconst getSelection = ({ editor, formatDefinition, selection }: Partial<ChangeDetails>) => {\n  if (!editor || !formatDefinition) return selection || { start: 0, end: 0 }\n\n  // Todo: expose an actual API for getting the current selection or fallback\n  const initialSelection = selection || toInk(editor.state.selection).pop() || { start: 0, end: 0 }\n\n  if (formatDefinition.block || formatDefinition.line || formatDefinition.multiline) {\n    const start = editor.lineBlockAt(initialSelection.start).from\n    const end = editor.lineBlockAt(initialSelection.end).to\n\n    return { start, end }\n  }\n\n  const start = editor.state.wordAt(initialSelection.start)?.from || initialSelection.start\n  const end = editor.state.wordAt(initialSelection.end)?.to || initialSelection.end\n\n  return { start, end }\n}\n\nconst getText = (changeDetails: ChangeDetails) => {\n  return changeDetails.editor.state.sliceDoc(changeDetails.selection.start, changeDetails.selection.end)\n}\n\nconst getNode = (editor: InkInternal.Editor, definition: FormatDefinition, selection: Ink.Editor.Selection) => {\n  const selectionNodes = getNodes(editor, selection)\n\n  return selectionNodes.find(({ type }) => definition.nodes.includes(type.name))\n}\n\nconst getNodes = (editor: InkInternal.Editor, selection: Ink.Editor.Selection) => {\n  const nodeDefinitions: NodeDefinition[] = []\n\n  syntaxTree(editor.state).iterate({\n    from: selection.start,\n    to: selection.end,\n    enter: ({ type, from, to }) => {\n      nodeDefinitions.push({ type, from, to })\n    },\n  })\n\n  return nodeDefinitions\n}\n\nconst unformat = (changeDetails: ChangeDetails) => {\n  const text = getText(changeDetails)\n  const sliceStart = changeDetails.formatDefinition.prefix.length\n  const sliceEnd = changeDetails.formatDefinition.suffix.length * -1 || text.length\n  const unformatted = text.slice(sliceStart, sliceEnd)\n\n  return [{ from: changeDetails.selection.start, to: changeDetails.selection.end, insert: unformatted }]\n}\n\nconst formatBlock = (changeDetails: ChangeDetails) => {\n  if (changeDetails.node) {\n    const start = changeDetails.node.from\n    const end = changeDetails.node.to\n\n    return unformat({ ...changeDetails, selection: { start, end } })\n  } else {\n    const before = changeDetails.formatDefinition.prefix\n    const after = changeDetails.formatDefinition.suffix\n\n    const changes = [\n      { from: changeDetails.selection.start, insert: before },\n      { from: changeDetails.selection.end, insert: after },\n    ]\n\n    return changes\n  }\n}\n\nconst formatMultiline = (changeDetails: ChangeDetails) => {\n  const selections = splitSelectionByLines(changeDetails)\n  const changes = <{ from: number, to?: number, insert: string }[]>[]\n\n  selections.forEach((selection) => {\n    const lineChanges = formatLine({ ...changeDetails, selection })\n\n    changes.push(...lineChanges)\n  })\n\n  return changes\n}\n\nconst formatLine = (changeDetails: ChangeDetails) => {\n  const hasPrefixStates = changeDetails.formatDefinition.prefixStates.length > 0\n  const text = getText(changeDetails)\n\n  if (changeDetails.node && hasPrefixStates) {\n    const prefixState = changeDetails.formatDefinition.prefixStates.find(prefix => text.startsWith(prefix))\n\n    if (prefixState) {\n      const prefixStateIndex = changeDetails.formatDefinition.prefixStates.indexOf(prefixState)\n      const nextPrefixState = changeDetails.formatDefinition.prefixStates[prefixStateIndex + 1]\n      const updatedText = text.replace(new RegExp(`^${prefixState}`), nextPrefixState)\n\n      return [{ from: changeDetails.selection.start, to: changeDetails.selection.end, insert: updatedText }]\n    }\n  } else if (changeDetails.node && text.startsWith(changeDetails.formatDefinition.prefix)) {\n    return unformat(changeDetails)\n  }\n\n  return [{ from: changeDetails.selection.start, insert: changeDetails.formatDefinition.prefix }]\n}\n\nconst formatInline = (changeDetails: ChangeDetails) => {\n  if (changeDetails.node) {\n    const start = changeDetails.node.from\n    const end = changeDetails.node.to\n\n    return unformat({ ...changeDetails, selection: { start, end } })\n  } else {\n    const { formatDefinition, selection } = changeDetails\n    const before = Array.isArray(formatDefinition.prefix) ? formatDefinition.prefix[0] : formatDefinition.prefix\n    const after = formatDefinition.suffix\n\n    return [\n      { from: selection.start, insert: before },\n      { from: selection.end, insert: after },\n    ]\n  }\n}\n\nconst getChanges = (changeDetails: ChangeDetails) => {\n  if (changeDetails.formatDefinition.block) {\n    return formatBlock(changeDetails)\n  } else if (changeDetails.formatDefinition.multiline) {\n    return formatMultiline(changeDetails)\n  } else if (changeDetails.formatDefinition.line) {\n    return formatLine(changeDetails)\n  }\n\n  return formatInline(changeDetails)\n}\n\nexport const format = (\n\t[state]: InkInternal.Store,\n\tformatType: Ink.EnumString<Ink.Values.Markup>,\n\t{ selection: maybeSelection }: Ink.Instance.FormatOptions = {}\n) => {\n\tconst { editor } = state();\n\tconst formatDefinition = formatting[formatType];\n\tconst selection = getSelection({\n\t\teditor,\n\t\tformatDefinition,\n\t\tselection: maybeSelection,\n\t});\n\n\t// Check if the selection is empty\n\tif (selection.start === selection.end) {\n\t\t// Insert the prefix and suffix around the cursor\n\t\tconst changes = [\n\t\t\t{ from: selection.start, insert: formatDefinition.prefix },\n\t\t\t{ from: selection.start, insert: formatDefinition.suffix },\n\t\t];\n\t\tconst cursorPosition = selection.start + formatDefinition.prefix.length;\n\t\tconst updates = state().editor.state.update({\n\t\t\tchanges,\n\t\t\tselection: { head: cursorPosition, anchor: cursorPosition },\n\t\t});\n\n\t\tstate().editor.dispatch(updates);\n    state().editor.focus();\n\t} else {\n\t\tconst node = getNode(editor, formatDefinition, selection);\n\t\tconst changeDetails: ChangeDetails = {\n\t\t\teditor,\n\t\t\tformatDefinition,\n\t\t\tnode,\n\t\t\tselection,\n\t\t};\n\t\tconst changes = getChanges(changeDetails);\n\t\tconst offset = changes.reduce(\n\t\t\t(total, change: { from: number; insert: string; to?: number }) => {\n\t\t\t\tconst offset =\n\t\t\t\t\tchange.insert.length - ((change.to || change.from) - change.from);\n\n\t\t\t\treturn total + offset;\n\t\t\t},\n\t\t\t0\n\t\t);\n\n\t\tconst updates = state().editor.state.update({\n\t\t\tchanges,\n\t\t\tselection: { head: selection.start, anchor: selection.end + offset },\n\t\t});\n\n\t\tstate().editor.dispatch(updates);\n    state().editor.focus();\n\t}\n};\n","import type InkInternal from '/types/internal'\n\nexport const getDoc = ([state]: InkInternal.Store) => {\n  const { editor } = state()\n\n  return editor.state.sliceDoc()\n}\n","import { toInk } from '/src/vendor/adapters/selections'\nimport type * as Ink from '/types/ink'\nimport type InkInternal from '/types/internal'\n\nexport const selections = ([state]: InkInternal.Store): Ink.Editor.Selection[] => {\n  const { editor } = state()\n\n  return toInk(editor.state.selection)\n}\n","import type * as Ink from '/types/ink'\nimport type InkInternal from '/types/internal'\nimport { selections } from './selections'\n\nexport const insert = ([state, setState]: InkInternal.Store, text: string, selection?: Ink.Editor.Selection, updateSelection = false) => {\n  const { editor } = state()\n\n  let start = selection?.start\n  let end = selection?.end || selection?.start\n\n  if (typeof start === 'undefined') {\n    const current = selections([state, setState]).pop() as Ink.Editor.Selection\n\n    start = current.start\n    end = current.end\n  }\n\n  const updates = { changes: { from: start, to: end, insert: text } }\n\n  if (updateSelection) {\n    const anchor = start === end ? start + text.length : start\n    const head = start === end ? start + text.length : start + text.length\n\n    Object.assign(updates, { selection: { anchor, head } })\n  }\n\n  editor.dispatch(\n    editor.state.update(updates),\n  )\n}\n","const types = {\n  array: '[object Array]',\n  object: '[object Object]',\n  string: '[object String]',\n  undefined: '[object Undefined]',\n  window: '[object Window]',\n}\n\nconst getType = (object: any) => {\n  const type = Object.prototype.toString.call(object)\n\n  if (type === types.object) {\n    return `[object ${object.constructor.name}]`\n  }\n}\n\nconst is = (object: any, type: string) => {\n  return getType(object) === type\n}\n\nconst deepAssign = (target: any, source: any) => {\n  const seen = new WeakMap()\n\n  const assign = (target: any, source: any) => {\n    if (seen.get(target)) return target\n    if (is(target, types.object)) seen.set(target, true)\n    if (is(source, types.undefined)) return target\n\n    if (is(target, types.array) && is(source, types.array)) {\n      return [...source]\n    }\n\n    if (is(target, types.object) && is(source, types.object)) {\n      return Object.keys(target).reduce((replacement: Record<PropertyKey, unknown>, key: PropertyKey) => {\n        if (Object.hasOwnProperty.call(source, key)) {\n          replacement[key] = assign(target[key], source[key])\n        } else {\n          replacement[key] = target[key]\n        }\n\n        return replacement\n      }, {})\n    }\n\n    return source\n  }\n\n  return assign(target, source)\n}\n\nexport const override = <T>(a: T, b: unknown): T => {\n  return deepAssign(a, b) as unknown as T\n}\n","export type ObjectTypeKey = keyof ObjectTypes\nexport type ObjectTypeValue = ObjectTypes[ObjectTypeKey]\nexport type ObjectTypes = typeof objectTypes\nexport type Thenable<T> = T extends { then: (...args: any[]) => any } ? T : never\n\nexport const objectTypes = {\n  array: '[object Array]',\n  asyncFunction: '[object AsyncFunction]',\n  boolean: '[object Boolean]',\n  function: '[object Function]',\n  null: '[object Null]',\n  number: '[object Number]',\n  object: '[object Object]',\n  promise: '[object Promise]',\n  string: '[object String]',\n  symbol: '[object Symbol]',\n  undefined: '[object Undefined]',\n  window: '[object Window]',\n} as const\n\nexport const is = <T>(type: ObjectTypeValue, object: T): object is T => {\n  return Object.prototype.toString.call(object) === type\n}\n\nexport const isArray = <T extends any[]>(object: T | any): object is T => is(objectTypes.array, object)\nexport const isAsyncFunction = <T extends (...args: any[]) => Promise<any>>(object: T | any): object is T => is(objectTypes.asyncFunction, object)\nexport const isBoolean = <T extends boolean>(object: T | any): object is T => is(objectTypes.boolean, object)\nexport const isFunction = <T extends (...args: any[]) => any>(object: T | any): object is T => is(objectTypes.function, object)\nexport const isNull = <T>(object: T | any): object is T => is(objectTypes.null, object)\nexport const isNumber = <T extends number>(object: T | any): object is T => is(objectTypes.number, object)\nexport const isObject = <T extends Record<any, any>>(object: T | any): object is T => is(objectTypes.object, object)\nexport const isPromise = <T>(object: T | Promise<T>): object is Promise<T> => is(objectTypes.promise, object)\nexport const isString = <T extends string>(object: T | any): object is T => is(objectTypes.string, object)\nexport const isSymbol = <T extends symbol>(object: T | any): object is T => is(objectTypes.symbol, object)\nexport const isUndefined = <T extends undefined>(object: T | any): object is T => is(objectTypes.undefined, object)\nexport const isWindow = <T extends Window>(object: T | any): object is T => is(objectTypes.window, object)\n\nexport const isThenable = <T extends { then: <A, R>(...args: A[]) => R }>(object: T | any): object is T => {\n  if (isPromise(object)) return true\n\n  return isObject(object) && ('then' in object) && (typeof object.then === 'function')\n}\n","import { isPromise } from '/src/utils/inspect'\nimport { type EnumString, type Options, type OptionsResolved, type Values } from '/types/ink'\n\nexport type FlattenArray<T> = ReturnType<typeof flatten<T>>\nexport type FnIntersectionToTuple<FnIntersection> = FnIntersection extends { (a: infer A): void, (b: infer B): void } ? [A, B] : never\nexport type FnUnionToFnIntersection<FnUnion> = (FnUnion extends unknown ? (arg: FnUnion) => void : never) extends ((arg: infer FnIntersection) => void) ? FnIntersection : never\nexport type Partition<T, V> = UnionToTuple<T> extends never\n? [T] extends [infer A]\n  ? V extends ((arg: any) => arg is A)\n    ? [A[], unknown[]]\n    : V extends ((arg: any) => arg is infer AssertionType)\n      ? [AssertionType[], Array<A>]\n      : never\n  : never\n: UnionToTuple<T> extends [infer A, infer B]\n  ? V extends ((arg: any) => arg is A)\n    ? [A[], B[]]\n    : V extends ((arg: any) => arg is B)\n      ? [B[], A[]]\n      : V extends ((arg: any) => arg is infer AssertionType)\n        ? [AssertionType[], Array<A | B>]\n        : never\n  : never\nexport type PluginHandler<T> = { [P in keyof T]: (variant: T[P]) => any }\nexport type PluginMatcher = { [K in PluginType]: Extract<Options.Plugin, { type: K }> }\nexport type PluginType = Options.Plugin['type']\nexport type PluginForType<T extends Values.PluginType> = Extract<Options.Plugin, { type: T }>\nexport type PluginValueForType<T extends Values.PluginType> = PluginForType<T>['value']\nexport type RecursiveArray<T> = Array<T | RecursiveArray<T>>\nexport type UnionToFnUnion<Union> = Union extends unknown ? (k: Union) => void : never\nexport type UnionToTuple<Union> = FnIntersectionToTuple<FnUnionToFnIntersection<UnionToFnUnion<Union>>>\nexport type ValidatorFn = (arg: any) => boolean\n\nexport const enumString = <T extends string>(value: T) => {\n  return `${value}` as EnumString<T>\n}\n\nexport const partitionPlugins = <T extends Options.Plugin['value']>(plugins: T[]) => {\n  return partition(plugins, isPromise)\n}\n\nexport const isPlugin = <T extends PluginType>(pluginType: T, plugin: Options.Plugin): plugin is PluginMatcher[T] => {\n  return plugin.type === pluginType\n}\n\nexport const isOptionsKey = (key: string, options: OptionsResolved): key is keyof OptionsResolved => {\n  return !!key && (key in options)\n}\n\nexport const filterPlugins = <T extends PluginType>(pluginType: T, options: OptionsResolved): PluginMatcher[T]['value'][] => {\n  return flatten(options.plugins).reduce<PluginMatcher[T]['value'][]>((matches, plugin: Options.Plugin) => {\n    if (isPlugin(pluginType, plugin)) {\n      // Todo: These \"plugin\" keys might be better suited under a namespace, but they are top-level for now.\n      // Individual key resolvers might be a good idea down the road to check for more fine-grained configuration options.\n      if (!plugin.key || (isOptionsKey(plugin.key, options) && options[plugin.key])) {\n        // @ts-expect-error Todo: Fix this type definition.\n        matches.push(plugin.value)\n      }\n    }\n\n    return matches\n  }, [])\n}\n\nexport const flatten = <T>(array: RecursiveArray<T>): T[] => {\n  return array.reduce<T[]>((flatArray, item) => {\n    if (Array.isArray(item)) {\n      return flatArray.concat(flatten(item))\n    }\n\n    return flatArray.concat(item)\n  }, [])\n}\n\nexport const partition = <ArrayTypes, Validator extends ValidatorFn>(array: ArrayTypes[], isValid: Validator): Partition<ArrayTypes, Validator> => {\n  return array.reduce<Partition<ArrayTypes, Validator>>((partitions, entry) => {\n    isValid(entry) ? partitions[0].push(entry) : partitions[1].push(entry)\n\n    return partitions\n  }, [[], []] as unknown as Partition<ArrayTypes, Validator>)\n}\n\n// partition(['string'], isNumber)\n// partition([1], isNumber)\n// partition(['hello', 1, 'yep', 4], isPromise)\n// partition(['hello', 1, 'yep', 4], isString)\n","import { markdown as markdownExtension, markdownLanguage } from '@codemirror/lang-markdown'\nimport { languages as baseLanguages } from '@codemirror/language-data'\nimport { Compartment } from '@codemirror/state'\nimport { type MarkdownExtension } from '@lezer/markdown'\nimport { buildVendorUpdates } from '/src/extensions'\nimport { filterPlugins, partitionPlugins } from '/src/utils/options'\nimport { type InkInternal, type OptionsResolved, pluginTypes } from '/types'\n\nconst makeExtension = ([state, setState]: InkInternal.Store) => {\n  const baseExtensions = [] as MarkdownExtension[]\n  const [lazyExtensions, extensions] = filterExtensions(state().options)\n  const [lazyLanguages, languages] = filterLanguages(state().options)\n\n  if (Math.max(lazyExtensions.length, lazyLanguages.length) > 0) {\n    state().workQueue.enqueue(async () => {\n      const effects = await buildVendorUpdates([state, setState])\n\n      state().editor.dispatch({ effects })\n    })\n  }\n\n  return markdownExtension({\n    base: markdownLanguage,\n    codeLanguages: [...baseLanguages, ...languages],\n    extensions: [...baseExtensions, ...extensions],\n  })\n}\n\nconst filterExtensions = (options: OptionsResolved) => {\n  return partitionPlugins(filterPlugins(pluginTypes.grammar, options))\n}\n\nconst filterLanguages = (options: OptionsResolved) => {\n  return partitionPlugins(filterPlugins(pluginTypes.language, options))\n}\n\nconst updateExtension = async ([state]: InkInternal.Store) => {\n  const baseExtensions = [] as MarkdownExtension[]\n  const extensions = await Promise.all(filterPlugins(pluginTypes.grammar, state().options))\n  const languages = await Promise.all(filterPlugins(pluginTypes.language, state().options))\n\n  return markdownExtension({\n    base: markdownLanguage,\n    codeLanguages: [...baseLanguages, ...languages],\n    extensions: [...baseExtensions, ...extensions],\n  })\n}\n\nexport const markdown = (): InkInternal.Extension => {\n  const compartment = new Compartment()\n\n  return {\n    compartment,\n    initialValue: (store: InkInternal.Store) => {\n      return compartment.of(makeExtension(store))\n    },\n    reconfigure: async (store: InkInternal.Store) => {\n      return compartment.reconfigure(await updateExtension(store))\n    },\n  }\n}\n","import type InkInternal from '/types/internal'\nimport type InkUi from '/types/ui'\nimport * as InkValues from '/types/values'\n\nexport const createElement = (): InkUi.Element => {\n  // Needed for tree-shaking purposes.\n  if (import.meta.env.VITE_SSR) {\n    return {} as InkUi.Element\n  }\n\n  return document.createElement('div')\n}\n\nexport const isAutoDark = () => {\n  // Needed for tree-shaking purposes.\n  if (import.meta.env.VITE_SSR) {\n    // Todo: Allow user to specify a default theme for SSR.\n    return true\n  }\n\n  return window.matchMedia('(prefers-color-scheme: dark)').matches\n}\n\nexport const isDark = (appearance: string) => {\n  if (appearance === InkValues.Appearance.Dark)\n    return true\n  if (appearance === InkValues.Appearance.Light)\n    return false\n\n  return isAutoDark()\n}\n\nexport const makeVars = (state: InkInternal.StateResolved) => {\n  // Todo: The syntax nodes should be merged with the tag nodes to ensure values are always set correctly. This might\n  // require extracting this out into a separate \"constants\" file or something similar.\n  const styles = [\n    // --ink-*\n    { suffix: 'border-radius', default: '0.25rem' },\n    { suffix: 'color', default: 'currentColor' },\n    { suffix: 'flex-direction', default: 'column' },\n    { suffix: 'font-family', default: 'inherit' },\n    // --ink-block-*\n    { suffix: 'block-background-color', default: '#121212', light: '#f5f5f5' },\n    { suffix: 'block-background-color-on-hover', default: '#0f0f0f', light: '#e0e0e0' },\n    { suffix: 'block-max-height', default: '20rem' },\n    { suffix: 'block-padding', default: '0.5rem' },\n    // --ink-code-*\n    { suffix: 'code-background-color', default: 'var(--ink-internal-block-background-color)' },\n    { suffix: 'code-color', default: 'inherit' },\n    { suffix: 'code-font-family', default: '\\'Monaco\\', Courier, monospace' },\n    // --ink-editor-*\n    { suffix: 'editor-font-size', default: '1em' },\n    { suffix: 'editor-line-height', default: '2em' },\n    { suffix: 'editor-padding', default: '0.5rem' },\n    { suffix: 'inline-padding', default: '0.125rem' },\n    // --ink-modal-*\n    { suffix: 'modal-position', default: 'fixed' },\n    // --ink-syntax-*\n    { suffix: 'syntax-atom-color', default: '#d19a66' },\n    { suffix: 'syntax-comment-color', default: '#abb2bf' },\n    { suffix: 'syntax-comment-font-style', default: 'italic' },\n    { suffix: 'syntax-emphasis-color', default: 'inherit' },\n    { suffix: 'syntax-emphasis-font-style', default: 'italic' },\n    { suffix: 'syntax-hashtag-background-color', default: '#222', light: '#eee' },\n    { suffix: 'syntax-hashtag-color', default: 'inherit' },\n    { suffix: 'syntax-heading-color', default: 'inherit' },\n    { suffix: 'syntax-heading-font-weight', default: '600' },\n    { suffix: 'syntax-heading1-color', default: 'var(--ink-internal-syntax-heading-color, inherit)' },\n    { suffix: 'syntax-heading1-font-size', default: '1.6em' },\n    { suffix: 'syntax-heading1-font-weight', default: '600' },\n    { suffix: 'syntax-heading2-color', default: 'var(--ink-internal-syntax-heading-color, inherit)' },\n    { suffix: 'syntax-heading2-font-size', default: '1.5em' },\n    { suffix: 'syntax-heading2-font-weight', default: '600' },\n    { suffix: 'syntax-heading3-color', default: 'var(--ink-internal-syntax-heading-color, inherit)' },\n    { suffix: 'syntax-heading3-font-size', default: '1.4em' },\n    { suffix: 'syntax-heading3-font-weight', default: '600' },\n    { suffix: 'syntax-heading4-color', default: 'var(--ink-internal-syntax-heading-color, inherit)' },\n    { suffix: 'syntax-heading4-font-size', default: '1.3em' },\n    { suffix: 'syntax-heading4-font-weight', default: '600' },\n    { suffix: 'syntax-heading5-color', default: 'var(--ink-internal-syntax-heading-color, inherit)' },\n    { suffix: 'syntax-heading5-font-size', default: '1.2em' },\n    { suffix: 'syntax-heading5-font-weight', default: '600' },\n    { suffix: 'syntax-heading6-color', default: 'var(--ink-internal-syntax-heading-color, inherit)' },\n    { suffix: 'syntax-heading6-font-size', default: '1.1em' },\n    { suffix: 'syntax-heading6-font-weight', default: '600' },\n    { suffix: 'syntax-highlight-background-color', default: '#555555' },\n    { suffix: 'syntax-keyword-color', default: '#c678dd' },\n    { suffix: 'syntax-link-color', default: 'inherit' },\n    { suffix: 'syntax-meta-color', default: '#abb2bf' },\n    { suffix: 'syntax-monospace-color', default: 'var(--ink-internal-code-color)' },\n    { suffix: 'syntax-monospace-font-family', default: 'var(--ink-internal-code-font-family)' },\n    { suffix: 'syntax-name-color', default: '#d19a66' },\n    { suffix: 'syntax-name-label-color', default: '#abb2bf' },\n    { suffix: 'syntax-name-property-color', default: '#96c0d8' },\n    { suffix: 'syntax-name-property-definition-color', default: '#e06c75' },\n    { suffix: 'syntax-name-variable-color', default: '#e06c75' },\n    { suffix: 'syntax-name-variable-definition-color', default: '#e5c07b' },\n    { suffix: 'syntax-name-variable-local-color', default: '#d19a66' },\n    { suffix: 'syntax-name-variable-special-color', default: 'inherit' },\n    { suffix: 'syntax-number-color', default: '#d19a66' },\n    { suffix: 'syntax-operator-color', default: '#96c0d8' },\n    { suffix: 'syntax-processing-instruction-color', default: '#444444', light: '#bbbbbb' },\n    { suffix: 'syntax-punctuation-color', default: '#abb2bf' },\n    { suffix: 'syntax-strikethrough-color', default: 'inherit' },\n    { suffix: 'syntax-strikethrough-text-decoration', default: 'line-through' },\n    { suffix: 'syntax-string-color', default: '#98c379' },\n    { suffix: 'syntax-string-special-color', default: 'inherit' },\n    { suffix: 'syntax-strong-color', default: 'inherit' },\n    { suffix: 'syntax-strong-font-weight', default: '600' },\n    { suffix: 'syntax-url-color', default: '#aaaaaa', light: '#666666' },\n    { suffix: 'toolbar-group-spacing', default: '2rem' },\n    { suffix: 'toolbar-item-spacing', default: '0' },\n  ]\n\n  const isLight = !isDark(state.options.interface.appearance)\n\n  return styles.map((style) => {\n    const value = (isLight && style.light) ? style.light : style.default\n\n    return `--ink-internal-${style.suffix}: var(--ink-${style.suffix}, ${value});`\n  })\n}\n","import type { Extension } from '@codemirror/state'\nimport { EditorView } from '@codemirror/view'\n\nexport const appearance = (isDark: boolean): Extension => {\n  return [\n    EditorView.theme({\n      '.cm-scroller': {\n        fontFamily: 'var(--ink-internal-font-family)',\n      },\n    }, { dark: isDark }),\n  ]\n}\n","import { Compartment } from '@codemirror/state'\nimport { markdown } from '/src/markdown'\nimport { isAutoDark } from '/src/ui/utils'\nimport { filterPlugins, partitionPlugins } from '/src/utils/options'\nimport { appearance } from '/src/vendor/extensions/appearance'\nimport { type InkInternal } from '/types'\nimport { appearanceTypes, pluginTypes } from '/types/values'\n\nexport const buildVendors = ([state, setState]: InkInternal.Store) => {\n  const extensions = state().extensions.map(e => e.initialValue([state, setState]))\n\n  return extensions\n}\n\nexport const buildVendorUpdates = async ([state, setState]: InkInternal.Store) => {\n  const effects = await Promise.all(\n    state().extensions.map(async (extension) => {\n      return await extension.reconfigure([state, setState])\n    }),\n  )\n\n  return effects\n}\n\nexport const extension = (resolver: InkInternal.ExtensionResolver): InkInternal.Extension => {\n  const compartment = new Compartment()\n\n  return {\n    compartment,\n    initialValue: (store: InkInternal.Store) => {\n      return compartment.of(resolver(store))\n    },\n    reconfigure: (store: InkInternal.Store) => {\n      return compartment.reconfigure(resolver(store))\n    },\n  }\n}\n\nexport const lazyExtension = (reconfigure: InkInternal.LazyExtensionResolver): InkInternal.LazyExtension => {\n  const compartment = new Compartment()\n\n  return {\n    compartment,\n    initialValue: () => {\n      return compartment.of([])\n    },\n    reconfigure: (store: InkInternal.Store) => {\n      return reconfigure(store, compartment)\n    },\n  }\n}\n\nexport const createExtensions = () => {\n  return [\n    markdown(),\n    ...resolvers.map(r => extension(r)),\n    ...lazyResolvers.map(r => lazyExtension(r)),\n  ]\n}\n\nexport const resolvers: InkInternal.ExtensionResolvers = [\n  ([state]: InkInternal.Store) => {\n    const [_lazyExtensions, extensions] = partitionPlugins(filterPlugins(pluginTypes.default, state().options))\n\n    return extensions\n  },\n  ([state]: InkInternal.Store) => {\n    const isDark = state().options.interface.appearance === appearanceTypes.dark\n    const isAuto = state().options.interface.appearance === appearanceTypes.auto\n    const extension = appearance(isDark || (isAuto && isAutoDark()))\n\n    return extension\n  },\n]\n\nexport const lazyResolvers: InkInternal.LazyExtensionResolvers = [\n  async ([state]: InkInternal.Store, compartment: InkInternal.Vendor.Compartment) => {\n    const [lazyExtensions] = partitionPlugins(filterPlugins(pluginTypes.default, state().options))\n\n    if (lazyExtensions.length > 0) {\n      return compartment.reconfigure(await Promise.all(lazyExtensions))\n    }\n\n    return compartment.reconfigure([])\n  },\n  async ([state]: InkInternal.Store, compartment: InkInternal.Vendor.Compartment) => {\n    if (state().options.interface.autocomplete) {\n      const { autocomplete } = await import('/src/vendor/extensions/autocomplete')\n\n      return compartment.reconfigure(autocomplete(state().options))\n    }\n\n    return compartment.reconfigure([])\n  },\n  async ([state]: InkInternal.Store, compartment: InkInternal.Vendor.Compartment) => {\n    if (state().options.interface.images) {\n      const { images } = await import('/src/vendor/extensions/images')\n\n      return compartment.reconfigure(images())\n    }\n\n    return compartment.reconfigure([])\n  },\n  async ([state]: InkInternal.Store, compartment: InkInternal.Vendor.Compartment) => {\n    const { keybindings, trapTab } = state().options\n    const tab = trapTab ?? keybindings.tab\n    const shiftTab = trapTab ?? keybindings.shiftTab\n\n    if (tab || shiftTab) {\n      const { indentWithTab } = await import('/src/vendor/extensions/indentWithTab')\n\n      return compartment.reconfigure(indentWithTab({ tab, shiftTab }))\n    }\n\n    return compartment.reconfigure([])\n  },\n  async ([state]: InkInternal.Store, compartment: InkInternal.Vendor.Compartment) => {\n    if (state().options.interface.lists) {\n      const { lists } = await import('/src/vendor/extensions/lists')\n\n      return compartment.reconfigure(lists())\n    }\n\n    return compartment.reconfigure([])\n  },\n  async ([state]: InkInternal.Store, compartment: InkInternal.Vendor.Compartment) => {\n    if (state().options.placeholder) {\n      const { placeholder } = await import('/src/vendor/extensions/placeholder')\n\n      return compartment.reconfigure(placeholder(state().options.placeholder))\n    }\n\n    return compartment.reconfigure([])\n  },\n  async ([state]: InkInternal.Store, compartment: InkInternal.Vendor.Compartment) => {\n    if (state().options.interface.readonly) {\n      const { readonly } = await import('/src/vendor/extensions/readonly')\n\n      return compartment.reconfigure(readonly())\n    }\n\n    return compartment.reconfigure([])\n  },\n  async ([state]: InkInternal.Store, compartment: InkInternal.Vendor.Compartment) => {\n    if (state().options.search) {\n      const { search } = await import('/src/vendor/extensions/search')\n\n      return compartment.reconfigure(search())\n    }\n\n    return compartment.reconfigure([])\n  },\n  async ([state]: InkInternal.Store, compartment: InkInternal.Vendor.Compartment) => {\n    if (state().options.interface.spellcheck) {\n      const { spellcheck } = await import('/src/vendor/extensions/spellcheck')\n\n      return compartment.reconfigure(spellcheck())\n    }\n\n    return compartment.reconfigure([])\n  },\n  async ([state]: InkInternal.Store, compartment: InkInternal.Vendor.Compartment) => {\n    if (state().options.vim) {\n      const { vim } = await import('/src/vendor/extensions/vim')\n\n      return compartment.reconfigure(vim())\n    }\n\n    return compartment.reconfigure([])\n  },\n]\n","import { syntaxTree } from '@codemirror/language'\nimport type { Extension } from '@codemirror/state'\nimport { RangeSetBuilder } from '@codemirror/state'\nimport type { EditorView } from '@codemirror/view'\nimport { Decoration, ViewPlugin } from '@codemirror/view'\n\n// const mark = 'QuoteMark'\n\nconst blockquoteSyntaxNodes = [\n  'Blockquote',\n]\n\nconst blockquoteDecoration = Decoration.line({ attributes: { class: 'cm-blockquote' } })\nconst blockquoteOpenDecoration = Decoration.line({ attributes: { class: 'cm-blockquote-open' } })\nconst blockquoteCloseDecoration = Decoration.line({ attributes: { class: 'cm-blockquote-close' } })\n\nconst blockquotePlugin = ViewPlugin.define((view: EditorView) => {\n  return {\n    update: () => {\n      return decorate(view)\n    },\n  }\n}, { decorations: plugin => plugin.update() })\n\nconst decorate = (view: EditorView) => {\n  const builder = new RangeSetBuilder<Decoration>()\n  const tree = syntaxTree(view.state)\n\n  for (const visibleRange of view.visibleRanges) {\n    for (let position = visibleRange.from; position < visibleRange.to;) {\n      const line = view.state.doc.lineAt(position)\n\n      tree.iterate({\n        enter({ type, from, to }) {\n          if (type.name !== 'Document') {\n            if (blockquoteSyntaxNodes.includes(type.name)) {\n              builder.add(line.from, line.from, blockquoteDecoration)\n\n              const openLine = view.state.doc.lineAt(from)\n              const closeLine = view.state.doc.lineAt(to)\n\n              if (openLine.number === line.number)\n                builder.add(line.from, line.from, blockquoteOpenDecoration)\n\n              if (closeLine.number === line.number)\n                builder.add(line.from, line.from, blockquoteCloseDecoration)\n\n              return false\n            }\n          }\n        },\n        from: line.from,\n        to: line.to,\n      })\n\n      position = line.to + 1\n    }\n  }\n\n  return builder.finish()\n}\n\nexport const blockquote = (): Extension => {\n  return [\n    blockquotePlugin,\n  ]\n}\n","import { syntaxTree } from '@codemirror/language'\nimport type { Extension } from '@codemirror/state'\nimport { RangeSetBuilder } from '@codemirror/state'\nimport type { EditorView } from '@codemirror/view'\nimport { Decoration, ViewPlugin } from '@codemirror/view'\n\nconst codeBlockSyntaxNodes = [\n  'CodeBlock',\n  'FencedCode',\n  'HTMLBlock',\n  'CommentBlock',\n]\n\nconst sharedAttributes = {\n  // Prevent spellcheck in all code blocks. The Grammarly extension might not respect these values.\n  'data-enable-grammarly': 'false',\n  'data-gramm': 'false',\n  'data-grammarly-skip': 'true',\n  'spellcheck': 'false',\n}\n\nconst codeBlockDecoration = Decoration.line({ attributes: { ...sharedAttributes, class: 'cm-codeblock' } })\nconst codeBlockOpenDecoration = Decoration.line({ attributes: { ...sharedAttributes, class: 'cm-codeblock-open' } })\nconst codeBlockCloseDecoration = Decoration.line({ attributes: { ...sharedAttributes, class: 'cm-codeblock-close' } })\nconst codeDecoration = Decoration.mark({ attributes: { ...sharedAttributes, class: 'cm-code' } })\nconst codeOpenDecoration = Decoration.mark({ attributes: { ...sharedAttributes, class: 'cm-code cm-code-open' } })\nconst codeCloseDecoration = Decoration.mark({ attributes: { ...sharedAttributes, class: 'cm-code cm-code-close' } })\n\nconst codeBlockPlugin = ViewPlugin.define((view: EditorView) => {\n  return {\n    update: () => {\n      return decorate(view)\n    },\n  }\n}, { decorations: plugin => plugin.update() })\n\nconst decorate = (view: EditorView) => {\n  const builder = new RangeSetBuilder<Decoration>()\n  const tree = syntaxTree(view.state)\n\n  for (const visibleRange of view.visibleRanges) {\n    for (let position = visibleRange.from; position < visibleRange.to;) {\n      const line = view.state.doc.lineAt(position)\n      let inlineCode: { from: number, to: number, innerFrom: number, innerTo: number }\n\n      tree.iterate({\n        enter({ type, from, to }) {\n          if (type.name !== 'Document') {\n            if (codeBlockSyntaxNodes.includes(type.name)) {\n              builder.add(line.from, line.from, codeBlockDecoration)\n\n              const openLine = view.state.doc.lineAt(from)\n              const closeLine = view.state.doc.lineAt(to)\n\n              if (openLine.number === line.number)\n                builder.add(line.from, line.from, codeBlockOpenDecoration)\n\n              if (closeLine.number === line.number)\n                builder.add(line.from, line.from, codeBlockCloseDecoration)\n\n              return false\n            } else if (type.name === 'InlineCode') {\n              // Store a reference for the last inline code node.\n              inlineCode = { from, to, innerFrom: from, innerTo: to }\n            } else if (type.name === 'CodeMark') {\n              // Make sure the code mark is a part of the previously stored inline code node.\n              if (from === inlineCode.from) {\n                inlineCode.innerFrom = to\n\n                builder.add(from, to, codeOpenDecoration)\n              } else if (to === inlineCode.to) {\n                inlineCode.innerTo = from\n\n                builder.add(inlineCode.innerFrom, inlineCode.innerTo, codeDecoration)\n                builder.add(from, to, codeCloseDecoration)\n              }\n            }\n          }\n        },\n        from: line.from,\n        to: line.to,\n      })\n\n      position = line.to + 1\n    }\n  }\n\n  return builder.finish()\n}\n\nexport const code = (): Extension => {\n  return [\n    codeBlockPlugin,\n  ]\n}\n","import type { Extension } from '@codemirror/state'\nimport { EditorView } from '@codemirror/view'\n\nconst inkClassExtensions = () => {\n  return [\n    EditorView.editorAttributes.of({\n      class: 'ink-mde-container',\n    }),\n    EditorView.contentAttributes.of({\n      class: 'ink-mde-editor-content',\n    }),\n    // Todo: Maybe open a PR to add scrollerAttributes?\n  ]\n}\n\nexport const ink = (): Extension => {\n  return [\n    ...inkClassExtensions(),\n  ]\n}\n","import type { Extension } from '@codemirror/state'\nimport { EditorView } from '@codemirror/view'\n\nexport const lineWrapping = (): Extension => {\n  return EditorView.lineWrapping\n}\n","import { HighlightStyle, syntaxHighlighting } from '@codemirror/language'\nimport type { Extension } from '@codemirror/state'\nimport { tags } from '@lezer/highlight'\n\nexport const theme = (): Extension => {\n  const extension = syntaxHighlighting(\n    HighlightStyle.define([\n      // ordered by lowest to highest precedence\n      {\n        tag: tags.atom,\n        color: 'var(--ink-internal-syntax-atom-color)',\n      },\n      {\n        tag: tags.meta,\n        color: 'var(--ink-internal-syntax-meta-color)',\n      },\n      // emphasis types\n      {\n        tag: tags.emphasis,\n        color: 'var(--ink-internal-syntax-emphasis-color)',\n        fontStyle: 'var(--ink-internal-syntax-emphasis-font-style)',\n      },\n      {\n        tag: tags.strong,\n        color: 'var(--ink-internal-syntax-strong-color)',\n        fontWeight: 'var(--ink-internal-syntax-strong-font-weight)',\n      },\n      {\n        tag: tags.strikethrough,\n        color: 'var(--ink-internal-syntax-strikethrough-color)',\n        textDecoration: 'var(--ink-internal-syntax-strikethrough-text-decoration)',\n      },\n      // comment group\n      {\n        tag: tags.comment,\n        color: 'var(--ink-internal-syntax-comment-color)',\n        fontStyle: 'var(--ink-internal-syntax-comment-font-style)',\n      },\n      // monospace\n      {\n        tag: tags.monospace,\n        color: 'var(--ink-internal-syntax-code-color)',\n        fontFamily: 'var(--ink-internal-syntax-code-font-family)',\n      },\n      // name group\n      {\n        tag: tags.name,\n        color: 'var(--ink-internal-syntax-name-color)',\n      },\n      {\n        tag: tags.labelName,\n        color: 'var(--ink-internal-syntax-name-label-color)',\n      },\n      {\n        tag: tags.propertyName,\n        color: 'var(--ink-internal-syntax-name-property-color)',\n      },\n      {\n        tag: tags.definition(tags.propertyName),\n        color: 'var(--ink-internal-syntax-name-property-definition-color)',\n      },\n      {\n        tag: tags.variableName,\n        color: 'var(--ink-internal-syntax-name-variable-color)',\n      },\n      {\n        tag: tags.definition(tags.variableName),\n        color: 'var(--ink-internal-syntax-name-variable-definition-color)',\n      },\n      {\n        tag: tags.local(tags.variableName),\n        color: 'var(--ink-internal-syntax-name-variable-local-color)',\n      },\n      {\n        tag: tags.special(tags.variableName),\n        color: 'var(--ink-internal-syntax-name-variable-special-color)',\n      },\n      // headings\n      {\n        tag: tags.heading,\n        color: 'var(--ink-internal-syntax-heading-color)',\n        fontWeight: 'var(--ink-internal-syntax-heading-font-weight)',\n      },\n      {\n        tag: tags.heading1,\n        color: 'var(--ink-internal-syntax-heading1-color)',\n        fontSize: 'var(--ink-internal-syntax-heading1-font-size)',\n        fontWeight: 'var(--ink-internal-syntax-heading1-font-weight)',\n      },\n      {\n        tag: tags.heading2,\n        color: 'var(--ink-internal-syntax-heading2-color)',\n        fontSize: 'var(--ink-internal-syntax-heading2-font-size)',\n        fontWeight: 'var(--ink-internal-syntax-heading2-font-weight)',\n      },\n      {\n        tag: tags.heading3,\n        color: 'var(--ink-internal-syntax-heading3-color)',\n        fontSize: 'var(--ink-internal-syntax-heading3-font-size)',\n        fontWeight: 'var(--ink-internal-syntax-heading3-font-weight)',\n      },\n      {\n        tag: tags.heading4,\n        color: 'var(--ink-internal-syntax-heading4-color)',\n        fontSize: 'var(--ink-internal-syntax-heading4-font-size)',\n        fontWeight: 'var(--ink-internal-syntax-heading4-font-weight)',\n      },\n      {\n        tag: tags.heading5,\n        color: 'var(--ink-internal-syntax-heading5-color)',\n        fontSize: 'var(--ink-internal-syntax-heading5-font-size)',\n        fontWeight: 'var(--ink-internal-syntax-heading5-font-weight)',\n      },\n      {\n        tag: tags.heading6,\n        color: 'var(--ink-internal-syntax-heading6-color)',\n        fontSize: 'var(--ink-internal-syntax-heading6-font-size)',\n        fontWeight: 'var(--ink-internal-syntax-heading6-font-weight)',\n      },\n      // contextual tag types\n      {\n        tag: tags.keyword,\n        color: 'var(--ink-internal-syntax-keyword-color)',\n      },\n      {\n        tag: tags.number,\n        color: 'var(--ink-internal-syntax-number-color)',\n      },\n      {\n        tag: tags.operator,\n        color: 'var(--ink-internal-syntax-operator-color)',\n      },\n      {\n        tag: tags.punctuation,\n        color: 'var(--ink-internal-syntax-punctuation-color)',\n      },\n      {\n        tag: tags.link,\n        color: 'var(--ink-internal-syntax-link-color)',\n      },\n      {\n        tag: tags.url,\n        color: 'var(--ink-internal-syntax-url-color)',\n      },\n      // string group\n      {\n        tag: tags.string,\n        color: 'var(--ink-internal-syntax-string-color)',\n      },\n      {\n        tag: tags.special(tags.string),\n        color: 'var(--ink-internal-syntax-string-special-color)',\n      },\n      // processing instructions\n      {\n        tag: tags.processingInstruction,\n        color: 'var(--ink-internal-syntax-processing-instruction-color)',\n      },\n    ]),\n  )\n\n  return [\n    extension,\n  ]\n}\n","import { defaultKeymap, history, historyKeymap } from \"@codemirror/commands\";\nimport { EditorSelection, EditorState } from \"@codemirror/state\";\nimport { keymap } from \"@codemirror/view\";\nimport { buildVendors } from \"/src/extensions\";\nimport { blockquote } from \"/src/vendor/extensions/blockquote\";\nimport { code } from \"/src/vendor/extensions/code\";\nimport { ink } from \"/src/vendor/extensions/ink\";\nimport { lineWrapping } from \"/src/vendor/extensions/line_wrapping\";\nimport { theme } from \"/src/vendor/extensions/theme\";\nimport type * as Ink from \"/types/ink\";\nimport type InkInternal from \"/types/internal\";\nimport { toCodeMirror } from \"./adapters/selections\";\n\nconst toVendorSelection = (\n\tselections: Ink.Editor.Selection[]\n): EditorSelection | undefined => {\n\tif (selections.length > 0) return toCodeMirror(selections);\n};\n\nexport const makeState = ([\n\tstate,\n\tsetState,\n]: InkInternal.Store): InkInternal.Vendor.State => {\n\treturn EditorState.create({\n\t\tdoc: state().options.doc,\n\t\tselection: toVendorSelection(state().options.selections),\n\t\textensions: [\n\t\t\tblockquote(),\n\t\t\tcode(),\n\t\t\thistory(),\n\t\t\tink(),\n\t\t\tlineWrapping(),\n\t\t\ttheme(),\n\t\t\tkeymap.of([...defaultKeymap, ...historyKeymap]),\n\t\t\t...buildVendors([state, setState]),\n\t\t],\n\t});\n};\n","import { override } from '/src/utils/merge'\nimport { makeState } from '/src/vendor/state'\nimport type InkInternal from '/types/internal'\n\nexport const load = ([state, setState]: InkInternal.Store, doc: string) => {\n  setState(override(state(), { options: { doc } }))\n\n  state().editor.setState(makeState([state, setState]))\n}\n","import type InkInternal from '/types/internal'\n\nexport const options = ([state]: InkInternal.Store) => {\n  return state().options\n}\n","import { buildVendorUpdates } from '/src/extensions'\nimport { override } from '/src/utils/merge'\nimport type * as Ink from '/types/ink'\nimport type InkInternal from '/types/internal'\n\nexport const reconfigure = async ([state, setState]: InkInternal.Store, options: Ink.Options) => {\n  const { workQueue } = state()\n\n  return workQueue.enqueue(async () => {\n    setState(override(state(), { options }))\n    const effects = await buildVendorUpdates([state, setState])\n\n    state().editor.dispatch({ effects })\n  })\n}\n","import { toCodeMirror } from '/src/vendor/adapters/selections'\nimport type * as Ink from '/types/ink'\nimport type InkInternal from '/types/internal'\nimport * as InkValues from '/types/values'\n\nexport const select = (store: InkInternal.Store, options: Ink.Instance.SelectOptions = {}) => {\n  if (options.selections)\n    return selectMultiple(store, options.selections)\n  if (options.selection)\n    return selectOne(store, options.selection)\n  if (options.at)\n    return selectAt(store, options.at)\n}\n\nexport const selectAt = (store: InkInternal.Store, at: Ink.Values.Selection) => {\n  const [state] = store\n\n  if (at === InkValues.Selection.Start)\n    return selectOne(store, { start: 0, end: 0 })\n\n  if (at === InkValues.Selection.End) {\n    const position = state().editor.state.doc.length\n\n    return selectOne(store, { start: position, end: position })\n  }\n}\n\nexport const selectMultiple = ([state]: InkInternal.Store, selections: Ink.Editor.Selection[]) => {\n  const { editor } = state()\n\n  editor.dispatch(\n    editor.state.update({\n      selection: toCodeMirror(selections),\n    }),\n  )\n}\n\nexport const selectOne = (store: InkInternal.Store, selection: Ink.Editor.Selection) => {\n  return selectMultiple(store, [selection])\n}\n","import type InkInternal from '/types/internal'\n\nexport const update = ([state]: InkInternal.Store, doc: string) => {\n  const { editor } = state()\n\n  editor.dispatch(\n    editor.state.update({\n      changes: {\n        from: 0,\n        to: editor.state.doc.length,\n        insert: doc,\n      },\n    }),\n  )\n}\n","import type * as Ink from '/types/ink'\nimport type InkInternal from '/types/internal'\nimport { insert } from './insert'\nimport { select } from './select'\nimport { selections } from './selections'\n\nexport const wrap = ([state, setState]: InkInternal.Store, { after, before, selection: userSelection }: Ink.Instance.WrapOptions) => {\n  const { editor } = state()\n\n  const selection = userSelection || selections([state, setState]).pop() || { start: 0, end: 0 }\n  const text = editor.state.sliceDoc(selection.start, selection.end)\n\n  insert([state, setState], `${before}${text}${after}`, selection)\n  select([state, setState], { selections: [{ start: selection.start + before.length, end: selection.end + before.length }] })\n}\n","import { type Thenable } from '/src/utils/inspect'\n\nexport type Awaitable<T> = () => Promise<T>\nexport type AwaitableCallbacks = { fulfilled: AwaitableCallback[], rejected: AwaitableCallback[], settled: AwaitableCallback[] }\nexport type AwaitableSettler<T = any> = (value: T) => void\nexport type AwaitableThenSettler<T = any, R = any> = (value: T) => R | Thenable<R>\nexport type AwaitableCallback = () => void\nexport type AwaitableHandler<ResolvedValue = unknown, RejectedValue = unknown> = (resolve: AwaitableSettler<ResolvedValue>, reject: AwaitableSettler<RejectedValue>) => any\nexport type AwaitableState = { callbacks: AwaitableCallbacks, error?: any, status: AwaitableStatus, value?: any }\nexport type AwaitableStatus = 'fulfilled' | 'pending' | 'rejected'\n\n// Todo: Make it so that it allows 2 values to be returned: first one for initial return object (merged with awaitable), second one for resolved object (defaults to the first)\nexport const awaitable = <InitialValue extends object, ResolvedValue = InitialValue, RejectedValue = unknown>(initialValue: InitialValue, handler: AwaitableHandler<ResolvedValue, RejectedValue>): InitialValue & Promise<ResolvedValue> => {\n  const state: AwaitableState = {\n    callbacks: {\n      fulfilled: [],\n      rejected: [],\n      settled: [],\n    },\n    status: 'pending',\n  }\n\n  const callback = (settler: AwaitableThenSettler, { resolve, reject }: { reject: AwaitableSettler, resolve?: AwaitableSettler }) => {\n    return () => {\n      try {\n        const settledValue = settler(state.value)\n\n        Promise.resolve(settledValue).then(resolve, reject)\n      } catch (error: any) {\n        reject(error)\n      }\n    }\n  }\n\n  const reject = (value: RejectedValue) => {\n    if (state.status === 'pending') {\n      state.status = 'rejected'\n      state.value = value\n\n      state.callbacks.rejected.forEach(callback => callback())\n      state.callbacks.settled.forEach(callback => callback())\n    }\n  }\n\n  const resolve = (value: ResolvedValue) => {\n    if (state.status === 'pending') {\n      state.status = 'fulfilled'\n      state.value = value\n\n      state.callbacks.fulfilled.forEach(callback => callback())\n      state.callbacks.settled.forEach(callback => callback())\n    }\n  }\n\n  const then = <OnFulfilled extends AwaitableThenSettler, OnRejected extends AwaitableThenSettler>(onFulfilled?: OnFulfilled, onRejected?: OnRejected) => {\n    return new Promise<ReturnType<Awaited<OnFulfilled>>>((resolve, reject) => {\n      if (state.status === 'pending') {\n        if (onFulfilled) {\n          state.callbacks.fulfilled.push(callback(onFulfilled, { resolve, reject }))\n        }\n\n        if (onRejected) {\n          state.callbacks.rejected.push(callback(onRejected, { resolve: undefined, reject }))\n        }\n      }\n\n      if (state.status === 'fulfilled' && onFulfilled) {\n        callback(onFulfilled, { resolve, reject })()\n      }\n\n      if (state.status === 'rejected' && onRejected) {\n        callback(onRejected, { resolve: undefined, reject })()\n      }\n    })\n  }\n\n  queueMicrotask(() => {\n    try {\n      handler(resolve, reject)\n    } catch (error: any) {\n      reject(error)\n    }\n  })\n\n  return {\n    ...initialValue,\n    [Symbol.toStringTag]: 'awaitable',\n    catch: then.bind(undefined, undefined),\n    finally: (onSettled: () => void) => {\n      return new Promise((resolve, reject) => {\n        if (state.status === 'pending') {\n          state.callbacks.settled.push(callback(onSettled, { resolve, reject }))\n        }\n\n        if (state.status === 'fulfilled') {\n          onSettled()\n          resolve(state.value)\n        }\n\n        if (state.status === 'rejected') {\n          onSettled()\n          reject(state.value)\n        }\n      })\n    },\n    then,\n  }\n}\n","import {\n  destroy,\n  focus,\n  format,\n  getDoc,\n  insert,\n  load,\n  options,\n  reconfigure,\n  select,\n  selections,\n  update,\n  wrap,\n} from '/src/api'\nimport { awaitable } from '/src/utils/awaitable'\nimport type * as Ink from '/types/ink'\nimport type InkInternal from '/types/internal'\n\nexport const makeInstance = (store: InkInternal.Store): Ink.AwaitableInstance => {\n  const instance = {\n    destroy: destroy.bind(undefined, store),\n    focus: focus.bind(undefined, store),\n    format: format.bind(undefined, store),\n    getDoc: getDoc.bind(undefined, store),\n    insert: insert.bind(undefined, store),\n    load: load.bind(undefined, store),\n    options: options.bind(undefined, store),\n    reconfigure: reconfigure.bind(undefined, store),\n    select: select.bind(undefined, store),\n    selections: selections.bind(undefined, store),\n    update: update.bind(undefined, store),\n    wrap: wrap.bind(undefined, store),\n  }\n\n  return awaitable(instance, (resolve, reject) => {\n    try {\n      const [state] = store\n\n      // Ensure all other queued tasks are finished before resolving.\n      state().workQueue.enqueue(() => resolve(instance))\n    } catch (error: any) {\n      reject(error)\n    }\n  })\n}\n","import { syntaxTree } from '@codemirror/language'\nimport { type EditorState, type Range, type RangeCursor, RangeSet, StateField, type Transaction } from '@codemirror/state'\nimport { Decoration, EditorView, type WidgetType } from '@codemirror/view'\nimport { type SyntaxNodeRef } from '@lezer/common'\n\n// Todo: Maybe open a PR to expose these types.\n// https://github.com/codemirror/view/blob/3f1b991f3db20d152045ae9e6872466fc8d8fdac/src/decoration.ts\nexport type LineDecorationSpec = { attributes?: { [key: string]: string }, class?: string, [other: string]: any }\nexport type MarkDecorationSpec = { attributes?: { [key: string]: string }, class?: string, inclusive?: boolean, inclusiveEnd?: boolean, inclusiveStart?: boolean, tagName?: string, [other: string]: any }\nexport type ReplaceDecorationSpec = { block?: boolean, inclusive?: boolean, inclusiveEnd?: boolean, inclusiveStart?: boolean, widget?: WidgetType, [other: string]: any }\nexport type WidgetDecorationSpec = { widget: WidgetType, block?: boolean, side?: number, [other: string]: any }\n\nexport type Defined<T> = Required<{\n  [K in keyof T]: NonNullable<T[K]>\n}>\n\n// Custom types.\nexport type CustomDecorationArgs = Parameters<typeof Decoration.mark>[0]\nexport type CustomDecoration<T> = T & Decoration\nexport type CustomDecorationTypes = 'line' | 'mark' | 'replace' | 'widget'\nexport type CustomWidget<T> = T & WidgetSpec\nexport type CustomWidgetArgs<T extends PartialWidgetSpec> = {\n  [K in keyof T]?: K extends 'eq' ? (other: CustomWidget<Defined<T>>) => boolean : T[K]\n}\nexport type CustomWidgetOptions<T extends PartialWidgetSpec> = {\n  [K in keyof T]: K extends 'compare' | 'eq' ? (other: CustomWidget<Defined<T>>) => boolean : T[K]\n}\nexport type CustomWidgetDecoration<T> = T & WidgetDecoration<T> & Decoration\nexport type CustomWidgetDecorationArgs = WidgetDecorationSpec & Record<string, any>\nexport type NodeBlockDecoration<T> = CustomWidgetDecoration<T> & { widget: { node: SyntaxNodeRef } }\nexport type NodeDecoratorArgs<T extends Decoration> = {\n  nodes: string[],\n  onMatch: (state: EditorState, node: SyntaxNodeRef) => T | T[] | void,\n  optimize?: boolean,\n  range?: {\n    from?: number,\n    to?: number,\n  },\n}\nexport type PartialWidgetSpec = Partial<WidgetSpec>\nexport type TypedDecoration = Decoration & { spec: Decoration['spec'] & { type: CustomDecorationTypes } }\nexport type WidgetSpec = WidgetType & { id?: string }\nexport type WidgetDecoration<T> = { block: boolean, side: number, widget: CustomWidget<T> }\n\nexport const buildBlockWidgetDecoration = <T extends CustomWidgetDecorationArgs>(options: T) => {\n  return buildWidgetDecoration({\n    block: true,\n    side: -1,\n    ...options,\n  })\n}\n\nexport const buildLineDecoration = <T extends MarkDecorationSpec>(options: T) => {\n  return Decoration.line({\n    ...options,\n    type: 'line',\n  }) as CustomDecoration<T>\n}\n\nexport const buildMarkDecoration = <T extends MarkDecorationSpec>(options: T) => {\n  return Decoration.mark({\n    ...options,\n    type: 'mark',\n  }) as CustomDecoration<T>\n}\n\nexport type WidgetOptions<T extends Record<string, any>> = {\n  [K in ((keyof T) | 'compare' | 'eq')]?: K extends 'compare' | 'eq' ? (other: WidgetReturn<T>) => boolean\n    : K extends keyof WidgetSpec ? WidgetSpec[K]\n    : T[K]\n}\nexport type WidgetReturn<T extends Record<string, any>> = {\n  [K in keyof (T & WidgetSpec)]: K extends keyof T ? NonNullable<T[K]>\n    : K extends keyof WidgetSpec ? WidgetSpec[K]\n    : never\n}\n\nexport const buildWidget = <T extends Record<string, any>>(options: WidgetOptions<T>): WidgetSpec => {\n  const eq = (other: WidgetReturn<T>) => {\n    if (options.eq) return options.eq(other)\n    if (!options.id) return false\n\n    return options.id === other.id\n  }\n\n  return {\n    compare: (other: WidgetReturn<T>) => {\n      return eq(other)\n    },\n    coordsAt: () => null,\n    destroy: () => {},\n    eq: (other: WidgetReturn<T>) => {\n      return eq(other)\n    },\n    estimatedHeight: -1,\n    ignoreEvent: () => true,\n    lineBreaks: 0,\n    toDOM: () => {\n      return document.createElement('span')\n    },\n    updateDOM: () => false,\n    ...options,\n  }\n}\n\nexport const buildWidgetDecoration = <T extends CustomWidgetDecorationArgs>(options: T): CustomWidgetDecoration<T> => {\n  return Decoration.widget({\n    block: false,\n    side: 0,\n    ...options,\n    widget: buildWidget({\n      ...options.widget,\n    }),\n    type: 'widget',\n  }) as CustomWidgetDecoration<T>\n}\n\nexport const buildNodeDecorations = <T extends TypedDecoration>(state: EditorState, options: NodeDecoratorArgs<T>) => {\n  const decorationRanges: Range<NodeBlockDecoration<T>>[] = []\n\n  syntaxTree(state).iterate({\n    enter: (node) => {\n      if (options.nodes.includes(node.type.name)) {\n        const maybeDecorations = options.onMatch(state, node)\n\n        if (!maybeDecorations) return\n\n        const decorations = Array<T>().concat(maybeDecorations)\n\n        decorations.forEach((decoration) => {\n          if (decoration.spec.type === 'line') {\n            const wrapped = buildLineDecoration({ ...decoration.spec, node: { ...node } })\n\n            for (let line = state.doc.lineAt(node.from); line.from < node.to; line = state.doc.lineAt(line.to + 1)) {\n              decorationRanges.push(wrapped.range(line.from))\n            }\n          }\n\n          if (decoration.spec.type === 'mark') {\n            const wrapped = buildMarkDecoration({ ...decoration.spec, node: { ...node } }).range(node.from, node.to)\n\n            decorationRanges.push(wrapped)\n          }\n\n          if (decoration.spec.type === 'widget') {\n            const wrapped = buildWidgetDecoration({ ...decoration.spec, node: { ...node } }).range(node.from)\n\n            decorationRanges.push(wrapped)\n          }\n        })\n      }\n    },\n    from: options.range?.from,\n    to: options.range?.to,\n  })\n\n  return decorationRanges.sort((left, right) => {\n    return left.from - right.from\n  })\n}\n\nexport const buildOptimizedNodeDecorations = <T extends Decoration>(rangeSet: RangeSet<NodeBlockDecoration<T>>, transaction: Transaction, options: NodeDecoratorArgs<T>) => {\n  const decorations = [] as Range<NodeBlockDecoration<T>>[]\n  const cursor = rangeSet.iter()\n  const cursors = [] as RangeCursor<NodeBlockDecoration<T>>[]\n  const cursorsToSkip = [] as RangeCursor<NodeBlockDecoration<T>>[]\n\n  while (cursor.value) {\n    cursors.push({ ...cursor })\n    cursor.next()\n  }\n\n  transaction.changes.iterChangedRanges((_beforeFrom, _beforeTo, changeFrom, changeTo) => {\n    cursors.forEach((cursor) => {\n      if (cursor.value) {\n        const nodeLength = cursor.value.spec.node.to - cursor.value.spec.node.from\n        const cursorFrom = cursor.from\n        const cursorTo = cursor.from + nodeLength\n\n        if (isOverlapping(cursorFrom, cursorTo, changeFrom, changeTo)) {\n          cursorsToSkip.push(cursor)\n        }\n      }\n    })\n\n    const range = { from: changeFrom, to: changeTo }\n\n    decorations.push(...buildNodeDecorations(transaction.state, { ...options, range }))\n  })\n\n  const cursorDecos = cursors.filter(cursor => !cursorsToSkip.includes(cursor)).flatMap((cursor) => {\n    const range = cursor.value?.range(cursor.from) as Range<NodeBlockDecoration<T>>\n\n    if (!range) return []\n\n    return [range]\n  })\n\n  decorations.push(...cursorDecos)\n\n  const allDecorations = decorations.sort((left, right) => {\n    return left.from - right.from\n  })\n\n  // This reprocesses the entire state.\n  return allDecorations\n}\n\nexport const isOverlapping = (x1: number, x2: number, y1: number, y2: number) => {\n  return Math.max(x1, y1) <= Math.min(x2, y2)\n}\n\nexport const nodeDecorator = <T extends Decoration>(options: NodeDecoratorArgs<T>) => {\n  return StateField.define<RangeSet<NodeBlockDecoration<T>>>({\n    create(state) {\n      return RangeSet.of(buildNodeDecorations(state, options))\n    },\n    update(rangeSet, transaction) {\n      // Reconfiguration and state effects will reprocess the entire state to ensure nothing is missed.\n      if (transaction.reconfigured || transaction.effects.length > 0) {\n        return RangeSet.of(buildNodeDecorations(transaction.state, options))\n      }\n\n      const updatedRangeSet = rangeSet.map(transaction.changes)\n\n      if (transaction.docChanged) {\n        // Only process the ranges that are affected by this change.\n        if (options.optimize) {\n          return RangeSet.of(buildOptimizedNodeDecorations(updatedRangeSet, transaction, options))\n        }\n\n        return RangeSet.of(buildNodeDecorations(transaction.state, options))\n      }\n\n      // No need to redecorate. Instead, just map the decorations through the transaction changes.\n      return updatedRangeSet\n    },\n    provide(field) {\n      // Provide the extension to the editor.\n      return EditorView.decorations.from(field)\n    },\n  })\n}\n","import { Tag } from '@lezer/highlight'\n\nexport const buildTag = <T extends Tag>(parent?: T) => {\n  return Tag.define(parent)\n}\n\nexport const getCharCode = (char: string) => {\n  return char.charCodeAt(0)\n}\n","import { type Tag, tags } from '@lezer/highlight'\nimport { type BlockParser, type DelimiterType, type InlineParser, type MarkdownConfig, type NodeSpec } from '@lezer/markdown'\nimport { buildTag, getCharCode } from './parsers'\n\nexport const buildMarkNode = (markName: string) => {\n  return buildTaggedNode(markName, [tags.processingInstruction])\n}\n\nexport const buildTaggedNode = (nodeName: string, styleTags: Tag[] = []) => {\n  const tag = buildTag()\n  const node = defineNode({\n    name: nodeName,\n    style: [tag, ...styleTags],\n  })\n\n  return {\n    node,\n    tag,\n  }\n}\n\nexport const defineBlockParser = <T extends BlockParser>(options: T) => options\nexport const defineDelimiter = <T extends DelimiterType>(options?: T) => ({ ...options })\nexport const defineInlineParser = <T extends InlineParser>(options: T) => options\nexport const defineMarkdown = <T extends MarkdownConfig>(options: T) => options\nexport const defineNode = <T extends NodeSpec>(options: T) => options\n\n/**\n * Build an inline Markdown parser that matches a custom expression. E.g. `[[hello]]` for wikilinks.\n *\n * @param options\n * @param options.name The name of the new node type. E.g. `WikiLink` for wikilinks.\n * @param options.prefix The tokens that indicate the start of the custom expression. E.g. `[[` for wikilinks.\n * @param options.suffix The tokens that indicate the end of the custom expression. E.g. `]]` for wikilinks.\n * @param options.matcher The regex that matches the custom expression. E.g. `/(?<prefix>\\[\\[)(?<content>.*?)(?<suffix>\\]\\])/` for wikilinks.\n */\nexport const buildInlineParser = (options: { name: string, prefix: string, matcher?: RegExp, suffix?: string }) => {\n  const { name, prefix, suffix } = options\n  const matcher = options.matcher || new RegExp(`(?<prefix>${prefix})(?<content>.*?)(?<suffix>${suffix})`)\n  const [firstCharCode, ...prefixCharCodes] = prefix.split('').map(getCharCode)\n\n  const taggedNode = buildTaggedNode(name)\n  const taggedNodeMark = buildMarkNode(`${name}Mark`)\n  const taggedNodeMarkStart = buildMarkNode(`${name}MarkStart`)\n  const taggedNodeMarkEnd = buildMarkNode(`${name}MarkEnd`)\n\n  return defineInlineParser({\n    name: taggedNode.node.name,\n    parse: (inlineContext, nextCharCode, position) => {\n      // Match the first char code as efficiently as possible.\n      if (nextCharCode !== firstCharCode) return -1\n\n      // Check the remaining char codes.\n      for (let i = 0; i < prefixCharCodes.length; i++) {\n        const prefixCharCode = prefixCharCodes[i]\n        const nextCharPosition = position + i + 1\n\n        if (inlineContext.text.charCodeAt(nextCharPosition) !== prefixCharCode) return -1\n      }\n\n      // Get all the line text left after the current position.\n      const remainingLineText = inlineContext.slice(position, inlineContext.end)\n\n      if (!matcher.test(remainingLineText)) return -1\n\n      const match = remainingLineText.match(matcher)\n\n      // Todo: Add config to allow empty?\n      if (!match?.groups?.content) return -1\n\n      const prefixLength = prefix.length\n      const contentLength = match.groups.content.length\n      const suffixLength = suffix?.length || 0\n\n      return inlineContext.addElement(\n        inlineContext.elt(\n          taggedNode.node.name,\n          position,\n          position + prefixLength + contentLength + suffixLength,\n          [\n            inlineContext.elt(\n              taggedNodeMark.node.name,\n              position,\n              position + prefixLength,\n              [\n                inlineContext.elt(\n                  taggedNodeMarkStart.node.name,\n                  position,\n                  position + prefixLength,\n                ),\n              ],\n            ),\n            inlineContext.elt(\n              taggedNodeMark.node.name,\n              position + prefixLength + contentLength,\n              position + prefixLength + contentLength + suffixLength,\n              [\n                inlineContext.elt(\n                  taggedNodeMarkEnd.node.name,\n                  position + prefixLength + contentLength,\n                  position + prefixLength + contentLength + suffixLength,\n                ),\n              ],\n            ),\n          ],\n        ),\n      )\n    },\n  })\n}\n","import { type Katex } from './importers/katex'\n\nexport type ModuleMap = Partial<{\n  katex: Katex | Promise<Katex>,\n}>\n\nexport const modules = new Proxy({}, {\n  get: (target: ModuleMap, prop: keyof ModuleMap, _receiver) => {\n    if (target[prop]) return target[prop]\n\n    return target[prop] = (async () => {\n      // Todo: Figure out whether including the extension here will pose a problem in the production build.\n      const { importer } = await import(`./importers/${prop}.ts`)\n      const imported = await importer() as Awaited<typeof target[typeof prop]>\n\n      target[prop] = imported\n\n      return imported!\n    })()\n  },\n})\n\n/**\n *\n * @example useModule('katex', (katex) => katex.render(...))\n */\nexport const useModule = (name: keyof ModuleMap, callback: (module: Awaited<Required<ModuleMap>[typeof name]>) => void) => {\n  if (!modules[name]) return console.error('[katex] module is not resolvable')\n  if ('then' in modules[name]!) return Promise.resolve(modules[name]!).then(callback)\n\n  callback(modules[name] as Awaited<Required<ModuleMap>[typeof name]>)\n}\n","import { buildMarkNode, buildTaggedNode, defineBlockParser, defineInlineParser, defineMarkdown, getCharCode } from '/lib/codemirror-kit'\n\nexport const charCodes = {\n  dollarSign: getCharCode('$'),\n}\n\nexport const mathInlineTestRegex = /\\$.*?\\$/\nexport const mathInlineCaptureRegex = /\\$(?<math>.*?)\\$/\n\nexport const mathInline = buildTaggedNode('MathInline')\nexport const mathInlineMark = buildMarkNode('MathInlineMark')\nexport const mathInlineMarkOpen = buildMarkNode('MathInlineMarkOpen')\nexport const mathInlineMarkClose = buildMarkNode('MathInlineMarkClose')\nexport const mathInlineParser = defineInlineParser({\n  name: mathInline.node.name,\n  parse: (inlineContext, nextCharCode, position) => {\n    // Not a \"$\" char.\n    if (nextCharCode !== charCodes.dollarSign) return -1\n\n    const remainingLineText = inlineContext.slice(position, inlineContext.end)\n\n    // No ending \"$\" found.\n    if (!mathInlineTestRegex.test(remainingLineText)) return -1\n\n    const match = remainingLineText.match(mathInlineCaptureRegex)\n\n    // No match found.\n    if (!match?.groups?.math) return -1\n\n    const mathExpressionLength = match.groups.math.length\n\n    return inlineContext.addElement(\n      inlineContext.elt(\n        mathInline.node.name,\n        position,\n        position + mathExpressionLength + 2,\n        [\n          inlineContext.elt(\n            mathInlineMark.node.name,\n            position,\n            position + 1,\n            [\n              inlineContext.elt(\n                mathInlineMarkOpen.node.name,\n                position,\n                position + 1,\n              ),\n            ],\n          ),\n          inlineContext.elt(\n            mathInlineMark.node.name,\n            position + mathExpressionLength + 1,\n            position + mathExpressionLength + 2,\n            [\n              inlineContext.elt(\n                mathInlineMarkClose.node.name,\n                position + mathExpressionLength + 1,\n                position + mathExpressionLength + 2,\n              ),\n            ],\n          ),\n        ],\n      ),\n    )\n  },\n})\n\nexport const mathBlockTestRegex = /\\$.*?\\$/\nexport const mathBlockCaptureRegex = /\\$(?<math>.*?)\\$/\n\nexport const mathBlock = buildTaggedNode('MathBlock')\nexport const mathBlockMark = buildMarkNode('MathBlockMark')\nexport const mathBlockMarkOpen = buildMarkNode('MathBlockMarkOpen')\nexport const mathBlockMarkClose = buildMarkNode('MathBlockMarkClose')\nexport const mathBlockParser = defineBlockParser({\n  name: 'MathBlock',\n  parse: (blockContext, line) => {\n    // Not \"$\"\n    if (line.next !== charCodes.dollarSign) return false\n    // Not \"$$\"\n    if (line.text.charCodeAt(line.pos + 1) !== charCodes.dollarSign) return false\n\n    const openLineStart = blockContext.lineStart + line.pos\n    const openLineEnd = openLineStart + line.text.length\n\n    // Move past opening line.\n    while (blockContext.nextLine()) {\n      // Closing \"$$\"\n      if (line.next === charCodes.dollarSign && line.text.charCodeAt(line.pos + 1) === charCodes.dollarSign) {\n        const closeLineStart = blockContext.lineStart + line.pos\n        const closeLineEnd = closeLineStart + line.text.length\n\n        blockContext.addElement(\n          blockContext.elt(\n            mathBlock.node.name,\n            openLineStart,\n            closeLineEnd,\n            [\n              blockContext.elt(\n                mathBlockMark.node.name,\n                openLineStart,\n                openLineEnd,\n                [\n                  blockContext.elt(\n                    mathBlockMarkOpen.node.name,\n                    openLineStart,\n                    openLineEnd,\n                  ),\n                ],\n              ),\n              blockContext.elt(\n                mathBlockMark.node.name,\n                closeLineStart,\n                closeLineEnd,\n                [\n                  blockContext.elt(\n                    mathBlockMarkClose.node.name,\n                    closeLineStart,\n                    closeLineEnd,\n                  ),\n                ],\n              ),\n            ],\n          ),\n        )\n\n        blockContext.nextLine()\n\n        break\n      }\n    }\n\n    return true\n  },\n})\n\nexport const grammar = defineMarkdown({\n  defineNodes: [\n    mathInline.node,\n    mathInlineMark.node,\n    mathInlineMarkClose.node,\n    mathInlineMarkOpen.node,\n    mathBlock.node,\n    mathBlockMark.node,\n    mathBlockMarkOpen.node,\n    mathBlockMarkClose.node,\n  ],\n  parseBlock: [\n    mathBlockParser,\n  ],\n  parseInline: [\n    mathInlineParser,\n  ],\n})\n","import { HighlightStyle, syntaxHighlighting } from '@codemirror/language'\nimport { EditorView } from '@codemirror/view'\nimport { plugin, pluginTypes } from 'ink-mde'\nimport { buildBlockWidgetDecoration, buildLineDecoration, buildWidget, nodeDecorator } from '/lib/codemirror-kit'\nimport { useModule } from '/src/modules'\nimport { grammar, mathInline, mathInlineMark, mathInlineMarkClose, mathInlineMarkOpen } from './grammar'\n\nconst render = (text: string, element: HTMLElement) => {\n  useModule('katex', (katex) => {\n    katex.render(text, element, { output: 'html', throwOnError: false })\n  })\n}\n\nexport const katex = () => {\n  return [\n    plugin({\n      key: 'katex',\n      type: pluginTypes.grammar,\n      value: async () => grammar,\n    }),\n    plugin({\n      key: 'katex',\n      value: async () => {\n        return nodeDecorator({\n          nodes: ['MathBlock', 'MathBlockMarkClose', 'MathBlockMarkOpen'],\n          onMatch: (_state, node) => {\n            const classes = ['ink-mde-line-math-block']\n\n            if (node.name === 'MathBlockMarkOpen') classes.push('ink-mde-line-math-block-open')\n            if (node.name === 'MathBlockMarkClose') classes.push('ink-mde-line-math-block-close')\n\n            return buildLineDecoration({\n              attributes: {\n                class: classes.join(' '),\n              },\n            })\n          },\n          optimize: false,\n        })\n      },\n    }),\n    plugin({\n      key: 'katex',\n      value: async () => {\n        return nodeDecorator({\n          nodes: ['MathBlock'],\n          onMatch: (state, node) => {\n            const text = state.sliceDoc(node.from, node.to).split('\\n').slice(1, -1).join('\\n')\n\n            if (text) {\n              return buildBlockWidgetDecoration({\n                widget: buildWidget({\n                  id: text,\n                  toDOM: () => {\n                    const container = document.createElement('div')\n                    const block = document.createElement('div')\n\n                    container.className = 'ink-mde-block-widget-container'\n                    block.className = 'ink-mde-block-widget ink-mde-katex-target'\n                    container.appendChild(block)\n\n                    render(text, block)\n\n                    return container\n                  },\n                  updateDOM: (dom) => {\n                    const katexTarget = dom.querySelector<HTMLElement>('.ink-mde-katex-target')\n\n                    if (katexTarget) {\n                      render(text, katexTarget)\n\n                      return true\n                    }\n\n                    return false\n                  },\n                }),\n              })\n            }\n          },\n          optimize: false,\n        })\n      },\n    }),\n    plugin({\n      key: 'katex',\n      value: async () => {\n        return syntaxHighlighting(\n          HighlightStyle.define([\n            {\n              tag: [mathInline.tag, mathInlineMark.tag],\n              backgroundColor: 'var(--ink-internal-block-background-color)',\n            },\n            {\n              tag: [mathInlineMarkClose.tag],\n              backgroundColor: 'var(--ink-internal-block-background-color)',\n              borderRadius: '0 var(--ink-internal-border-radius) var(--ink-internal-border-radius) 0',\n              paddingRight: 'var(--ink-internal-inline-padding)',\n            },\n            {\n              tag: [mathInlineMarkOpen.tag],\n              backgroundColor: 'var(--ink-internal-block-background-color)',\n              borderRadius: 'var(--ink-internal-border-radius) 0 0 var(--ink-internal-border-radius)',\n              paddingLeft: 'var(--ink-internal-inline-padding)',\n            },\n          ]),\n        )\n      },\n    }),\n    plugin({\n      key: 'katex',\n      value: async () => {\n        return EditorView.theme({\n          '.ink-mde-line-math-block': {\n            backgroundColor: 'var(--ink-internal-block-background-color)',\n            padding: '0 var(--ink-internal-block-padding) !important',\n          },\n          '.ink-mde-line-math-block-open': {\n            borderRadius: 'var(--ink-internal-border-radius) var(--ink-internal-border-radius) 0 0',\n          },\n          '.ink-mde-line-math-block-close': {\n            borderRadius: '0 0 var(--ink-internal-border-radius) var(--ink-internal-border-radius)',\n          },\n        })\n      },\n    }),\n  ]\n}\n","export type Queue = ReturnType<typeof makeQueue>\n\nexport const makeQueue = () => {\n  const state = {\n    queue: <(() => Promise<void>)[]>[],\n    workload: 0,\n  }\n\n  const process = async () => {\n    const task = state.queue.pop()\n\n    if (!task) return\n\n    await task()\n\n    state.workload--\n\n    await process()\n  }\n\n  return {\n    enqueue: (callback: () => void | Promise<void>): Promise<void> => {\n      return new Promise((resolve, reject) => {\n        const task = async () => {\n          try {\n            await callback()\n\n            resolve()\n          } catch (error) {\n            reject(error)\n          }\n        }\n\n        state.queue.push(task)\n        state.workload++\n\n        // If the queue has other items in it, then it will drain itself.\n        if (state.workload > 1) return\n\n        process()\n      })\n    },\n  }\n}\n","import { createSignal } from 'solid-js'\nimport { katex } from '/plugins/katex'\nimport { createExtensions } from '/src/extensions'\nimport { override } from '/src/utils/merge'\nimport { makeQueue } from '/src/utils/queue'\nimport type { Options } from '/types/ink'\nimport type InkInternal from '/types/internal'\nimport * as InkValues from '/types/values'\nimport { createElement } from './ui/utils'\n\nexport const blankState = (): InkInternal.StateResolved => {\n  const options = {\n    doc: '',\n    files: {\n      clipboard: false,\n      dragAndDrop: false,\n      handler: () => {},\n      injectMarkup: true,\n      types: ['image/*'],\n    },\n    hooks: {\n      afterUpdate: () => {},\n      beforeUpdate: () => {},\n    },\n    interface: {\n      appearance: InkValues.Appearance.Auto,\n      attribution: true,\n      autocomplete: false,\n      images: false,\n      lists: false,\n      readonly: false,\n      spellcheck: true,\n      toolbar: false,\n    },\n    katex: false,\n    keybindings: {\n      // Todo: Set these to false by default. https://codemirror.net/examples/tab\n      tab: true,\n      shiftTab: true,\n    },\n    placeholder: '',\n    plugins: [\n      katex(),\n    ],\n    readability: false,\n    search: true,\n    selections: [],\n    toolbar: {\n      bold: true,\n      code: true,\n      codeBlock: true,\n      heading: true,\n      image: true,\n      italic: true,\n      link: true,\n      list: true,\n      orderedList: true,\n      quote: true,\n      taskList: true,\n      upload: false,\n    },\n    // This value overrides both `tab` and `shiftTab` keybindings.\n    trapTab: undefined,\n    vim: false,\n  }\n\n  return {\n    doc: '',\n    editor: {} as InkInternal.Editor,\n    extensions: createExtensions(),\n    options,\n    root: createElement(),\n    target: createElement(),\n    workQueue: makeQueue(),\n  }\n}\n\nexport const makeState = (partialState: InkInternal.State): InkInternal.StateResolved => {\n  return override(blankState(), partialState)\n}\n\nexport const makeStore = (options: Options, overrides: InkInternal.State = {}): InkInternal.Store => {\n  const [state, setState] = createSignal(makeState({ ...overrides, doc: options.doc || '', options }))\n\n  return [state, setState]\n}\n","export const DEFAULT_WORDS_PER_MINUTE = 225\n\nexport const toHuman = (text: string, wordsPerMinute: number = DEFAULT_WORDS_PER_MINUTE): string => {\n  const readTime = toHumanReadTime(text, wordsPerMinute)\n  const wordCount = toHumanWordCount(text)\n  const lineCount = toHumanLineCount(text)\n  const charCount = toHumanCharCount(text)\n\n  return [readTime, wordCount, lineCount, charCount].join(' | ')\n}\n\nexport const toHumanCharCount = (text: string): string => {\n  const charCount = toCharCount(text)\n\n  return `${charCount} chars`\n}\n\nexport const toHumanLineCount = (text: string): string => {\n  const lineCount = toLineCount(text)\n\n  return `${lineCount} lines`\n}\n\nexport const toHumanReadTime = (text: string, wordsPerMinute: number = DEFAULT_WORDS_PER_MINUTE): string => {\n  const readTime = toReadTime(text, wordsPerMinute)\n  const readTimeMinutes = Math.floor(readTime)\n  const readTimeSeconds = Math.floor((readTime % 1) * 60)\n\n  if (readTimeMinutes === 0) {\n    return `${readTimeSeconds}s read`\n  }\n\n  return `${readTimeMinutes}m ${readTimeSeconds}s to read`\n}\n\nexport const toHumanWordCount = (text: string): string => {\n  const wordCount = toWordCount(text)\n\n  return `${wordCount} words`\n}\n\nexport const toCharCount = (text: string): number => {\n  return text.length\n}\n\nexport const toLineCount = (text: string): number => {\n  return text.split(/\\n/).length\n}\n\nexport const toReadTime = (text: string, wordsPerMinute: number = DEFAULT_WORDS_PER_MINUTE): number => {\n  return toWordCount(text) / wordsPerMinute\n}\n\nexport const toWordCount = (text: string): number => {\n  const scrubbed = text.replace(/[']/g, '').replace(/[^\\w\\d]+/g, ' ').trim()\n\n  if (!scrubbed) {\n    return 0\n  }\n\n  return scrubbed.split(/\\s+/).length\n}\n","import { type Component, Show } from 'solid-js'\nimport { toHuman } from '/src/utils/readability'\nimport type InkInternal from '/types/internal'\nimport { useStore } from '../../app'\n\nexport const Details: Component<{ store: InkInternal.Store }> = () => {\n  const [state] = useStore()\n\n  return (\n    <div class='ink-mde-details'>\n      <div class='ink-mde-container'>\n        <div class='ink-mde-details-content'>\n          <Show when={ state().options.readability }>\n            <div class='ink-mde-readability'>\n              <span>{ toHuman(state().doc) }</span>\n            </div>\n          </Show>\n          <Show when={ state().options.readability && state().options.interface.attribution }>\n            <span>&nbsp;|</span>\n          </Show>\n          <Show when={state().options.interface.attribution}>\n            <div class='ink-mde-attribution'>\n              <span>&nbsp;powered by <a class='ink-mde-attribution-link' href='https://github.com/davidmyersdev/ink-mde' rel='noopener noreferrer' target='_blank'>ink-mde</a></span>\n            </div>\n          </Show>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import type { Component } from 'solid-js'\nimport { For, Show, createSignal, onCleanup, onMount } from 'solid-js'\nimport { insert } from '/src/api'\nimport { useStore } from '../../app'\nimport styles from './styles.css?inline'\n\nexport const DropZone: Component = () => {\n  const [depth, setDepth] = createSignal(0)\n  const [files, setFiles] = createSignal<File[]>([])\n  const [isLoading, setIsLoading] = createSignal(false)\n  const [isVisible, setIsVisible] = createSignal(false)\n  const [state, setState] = useStore()\n\n  const closeModal = () => {\n    setIsVisible(false)\n  }\n\n  const dropOnZone = (event: DragEvent) => {\n    if (state().options.files.dragAndDrop) {\n      event.preventDefault()\n      event.stopPropagation()\n\n      const transfer = event.dataTransfer\n\n      if (transfer?.files) {\n        uploadFiles(transfer.files)\n      } else {\n        setDepth(0)\n        setIsVisible(false)\n        setFiles([])\n      }\n    }\n  }\n\n  const onDragEnter = (event: DragEvent) => {\n    if (state().options.files.dragAndDrop) {\n      event.preventDefault()\n\n      setDepth(depth() + 1)\n      setIsVisible(true)\n    }\n  }\n\n  const onDragLeave = (event: DragEvent) => {\n    if (state().options.files.dragAndDrop) {\n      event.preventDefault()\n\n      setDepth(depth() - 1)\n\n      if (depth() === 0)\n        setIsVisible(false)\n    }\n  }\n\n  const onDragOver = (event: DragEvent) => {\n    if (state().options.files.dragAndDrop) {\n      event.preventDefault()\n\n      setIsVisible(true)\n    }\n  }\n\n  const onDrop = (event: DragEvent) => {\n    if (state().options.files.dragAndDrop) {\n      event.preventDefault()\n\n      setDepth(0)\n      setIsVisible(false)\n    }\n  }\n\n  const onPaste = (event: ClipboardEvent) => {\n    if (state().options.files.clipboard) {\n      event.preventDefault()\n\n      const transfer = event.clipboardData\n\n      if (transfer?.files && transfer.files.length > 0)\n        uploadFiles(transfer.files)\n    }\n  }\n\n  const uploadFiles = (userFiles: FileList) => {\n    Array.from(userFiles).forEach((file) => {\n      setFiles([...files(), file])\n    })\n\n    setIsLoading(true)\n    setIsVisible(true)\n\n    Promise.resolve(state().options.files.handler(userFiles)).then((url) => {\n      if (state().options.files.injectMarkup && url) {\n        const markup = `![](${url})`\n\n        insert([state, setState], markup)\n      }\n    }).finally(() => {\n      setDepth(0)\n      setIsLoading(false)\n      setIsVisible(false)\n      setFiles([])\n    })\n  }\n\n  onMount(() => {\n    document.addEventListener('dragenter', onDragEnter)\n    document.addEventListener('dragleave', onDragLeave)\n    document.addEventListener('dragover', onDragOver)\n    document.addEventListener('drop', onDrop)\n    state().root.addEventListener('paste', onPaste)\n  })\n\n  onCleanup(() => {\n    document.removeEventListener('dragenter', onDragEnter)\n    document.removeEventListener('dragleave', onDragLeave)\n    document.removeEventListener('dragover', onDragOver)\n    document.removeEventListener('drop', onDrop)\n    state().root.removeEventListener('paste', onPaste)\n  })\n\n  return (\n    <div class=\"ink-drop-zone\" classList={{ visible: isVisible() }}>\n      <style textContent={styles} />\n      <div class=\"ink-drop-zone-modal\">\n        <div class=\"ink-drop-zone-droppable-area\" onDrop={dropOnZone}>\n          <div class=\"ink-drop-zone-file-preview\">\n            <For each={files().slice(0, 8)}>{file => (\n              <img class=\"ink-drop-zone-file-preview-image\" alt={file.name} src={URL.createObjectURL(file)} />\n            )}</For>\n          </div>\n          <Show when={isLoading()} fallback={<span>drop files here</span>}>\n            <span>uploading files...</span>\n          </Show>\n        </div>\n        <div class=\"ink-drop-zone-hide\" onClick={closeModal}>\n          <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n          </svg>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { EditorView, keymap } from '@codemirror/view'\n// import { makeState } from '/src/vendor/state'\nimport type InkInternal from '/types/internal'\n\nexport const makeEditor = ([state, setState]: InkInternal.Store, target?: HTMLElement): InkInternal.Editor => {\n  const rootNode = target?.getRootNode()\n  const root = rootNode?.nodeType === 11 ? rootNode as ShadowRoot : undefined\n\n  const editor = new EditorView({\n    dispatch: (transaction: InkInternal.Vendor.Transaction) => {\n      const { options } = state()\n      const newDoc = transaction.newDoc.toString()\n\n      options.hooks.beforeUpdate(newDoc)\n      editor.update([transaction])\n\n      if (transaction.docChanged) {\n        setState({ ...state(), doc: newDoc })\n\n        options.hooks.afterUpdate(newDoc)\n      }\n    },\n    root,\n    // state: makeState([state, setState]),\n    extensions: [keymap.of([\n      {\n        key: \"Mod-k\",\n        run: () => {\n          console.log('hi')\n          return true\n        }\n      }\n    ])],\n  })\n\n  return editor\n}\n","import type { Component } from 'solid-js'\nimport { buildVendorUpdates } from '/src/extensions'\nimport { useStore } from '/src/ui/app'\nimport { override } from '/src/utils/merge'\nimport { makeEditor } from '/src/vendor/editor'\n\nexport const Editor: Component<{ target?: HTMLElement }> = (props) => {\n  // Needed for tree-shaking purposes.\n  if (import.meta.env.VITE_SSR) {\n    return (\n      <div class='cm-editor'>\n        <div class='cm-scroller'>\n          <div class='cm-content' contenteditable={true}>\n            <div class='cm-line'>\n              <br />\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  const [state, setState] = useStore()\n  // eslint-disable-next-line solid/reactivity\n  const editor = makeEditor([state, setState], props.target)\n\n  const { workQueue } = state()\n  setState(override(state(), { editor }))\n\n  workQueue.enqueue(async () => {\n    const effects = await buildVendorUpdates([state, setState])\n\n    editor.dispatch({ effects })\n  })\n\n  return editor.dom\n}\n","import type { Component, JSX } from 'solid-js'\n\nexport const Button: Component<{ children: JSX.Element, onclick: JSX.EventHandler<HTMLButtonElement, MouseEvent> }> = (props) => {\n  return (\n    <button class='ink-button' onClick={e => props.onclick(e)} type='button'>\n      {props.children}\n    </button>\n  )\n}\n","import { Show, createSignal } from 'solid-js'\nimport type { Component } from 'solid-js'\nimport { focus, format, insert } from '/src/api'\nimport { useStore } from '/src/ui/app'\nimport * as InkValues from '/types/values'\nimport { Button } from '../button'\nimport styles from './styles.css?inline'\n\nexport const Toolbar: Component = () => {\n  const [state, setState] = useStore()\n  const [uploader, setUploader] = createSignal<HTMLInputElement>()\n\n  const formatAs = (type: InkValues.Markup) => {\n    format([state, setState], type)\n    focus([state, setState])\n  }\n\n  const uploadChangeHandler = (event: Event) => {\n    const target = event.target as HTMLInputElement\n\n    if (target?.files) {\n      Promise.resolve(state().options.files.handler(target.files)).then((url) => {\n        if (url) {\n          const markup = `![](${url})`\n\n          insert([state, setState], markup)\n          focus([state, setState])\n        }\n      })\n    }\n  }\n\n  const uploadClickHandler = () => {\n    uploader()?.click()\n  }\n\n  return (\n    <div class='ink-mde-toolbar'>\n      <style textContent={styles} />\n      <div class='ink-mde-container'>\n        <Show when={state().options.toolbar.heading || state().options.toolbar.bold || state().options.toolbar.italic}>\n          <div class='ink-mde-toolbar-group'>\n            <Show when={state().options.toolbar.heading}>\n              <Button onclick={() => formatAs(InkValues.Markup.Heading)}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <path d='M6 4V10M6 16V10M6 10H14M14 10V4M14 10V16'/>\n                </svg>\n              </Button>\n            </Show>\n            <Show when={state().options.toolbar.bold}>\n              <Button onclick={() => formatAs(InkValues.Markup.Bold)}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-width='1.5' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <path d='M6.5 10H10.5C12.1569 10 13.5 11.3431 13.5 13C13.5 14.6569 12.1569 16 10.5 16H6.5V4H9.5C11.1569 4 12.5 5.34315 12.5 7C12.5 8.65686 11.1569 10 9.5 10'/>\n                </svg>\n              </Button>\n            </Show>\n            <Show when={state().options.toolbar.italic}>\n              <Button onclick={() => formatAs(InkValues.Markup.Italic)}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <path d='M11 4L9 16M13 4H9M7 16H11'/>\n                </svg>\n              </Button>\n            </Show>\n          </div>\n        </Show>\n        <Show when={state().options.toolbar.quote || state().options.toolbar.codeBlock || state().options.toolbar.code}>\n          <div class='ink-mde-toolbar-group'>\n            <Show when={state().options.toolbar.quote}>\n              <Button onclick={() => formatAs(InkValues.Markup.Quote)}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <path d='M2.00257 16H17.9955M2.00055 4H18M7 10H18.0659M2 8.5V11.4999C2.4 11.5 2.5 11.5 2.5 11.5V11V10.5M4 8.5V11.4999H4.5V11V10.5'/>\n                </svg>\n              </Button>\n            </Show>\n            <Show when={state().options.toolbar.codeBlock}>\n              <Button onclick={() => formatAs(InkValues.Markup.CodeBlock)}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <path d='M13 4L7 16'/>\n                  <path d='M5 7L2 10L5 13'/>\n                  <path d='M15 7L18 10L15 13'/>\n                </svg>\n              </Button>\n            </Show>\n            <Show when={state().options.toolbar.code}>\n              <Button onclick={() => formatAs(InkValues.Markup.Code)}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <path d='M7 4L8 6'/>\n                </svg>\n              </Button>\n            </Show>\n          </div>\n        </Show>\n        <Show when={state().options.toolbar.list || state().options.toolbar.orderedList || state().options.toolbar.taskList}>\n          <div class='ink-mde-toolbar-group'>\n            <Show when={state().options.toolbar.list}>\n              <Button onclick={() => formatAs(InkValues.Markup.List)}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <path d='M7 16H17.8294'/>\n                  <path d='M2 16H4'/>\n                  <path d='M7 10H17.8294'/>\n                  <path d='M2 10H4'/>\n                  <path d='M7 4H17.8294'/>\n                  <path d='M2 4H4'/>\n                </svg>\n              </Button>\n            </Show>\n            <Show when={state().options.toolbar.orderedList}>\n              <Button onclick={() => formatAs(InkValues.Markup.OrderedList)}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <path d='M7 16H18'/>\n                  <path d='M2 17.0242C2.48314 17.7569 3.94052 17.6154 3.99486 16.7919C4.05315 15.9169 3.1975 16.0044 2.99496 16.0044M2.0023 14.9758C2.48544 14.2431 3.94282 14.3846 3.99716 15.2081C4.05545 16.0831 3.1998 16.0002 2.99726 16.0002'/>\n                  <path d='M7 10H18'/>\n                  <path d='M2.00501 11.5H4M2.00193 8.97562C2.48449 8.24319 3.9401 8.38467 3.99437 9.20777C4.05259 10.0825 2.04342 10.5788 2 11.4996'/>\n                  <path d='M7 4H18'/>\n                  <path d='M2 5.5H4M2.99713 5.49952V2.5L2.215 2.93501'/>\n                </svg>\n              </Button>\n            </Show>\n            <Show when={state().options.toolbar.taskList}>\n              <Button onclick={() => formatAs(InkValues.Markup.TaskList)}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <path d='M7 16H17.8294'/>\n                  <path d='M5 15L3 17L2 16'/>\n                  <path d='M7 10H17.8294'/>\n                  <path d='M5 9L3 11L2 10'/>\n                  <path d='M7 4H17.8294'/>\n                  <path d='M5 3L3 5L2 4'/>\n                </svg>\n              </Button>\n            </Show>\n          </div>\n        </Show>\n        <Show when={state().options.toolbar.link || state().options.toolbar.image || state().options.toolbar.upload}>\n          <div class='ink-mde-toolbar-group'>\n            <Show when={state().options.toolbar.link}>\n              <Button onclick={() => formatAs(InkValues.Markup.Link)}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <path d='M9.12127 10.881C10.02 11.78 11.5237 11.7349 12.4771 10.7813L15.2546 8.00302C16.2079 7.04937 16.253 5.54521 15.3542 4.6462C14.4555 3.74719 12.9512 3.79174 11.9979 4.74539L10.3437 6.40007M10.8787 9.11903C9.97997 8.22002 8.47626 8.26509 7.52288 9.21874L4.74545 11.997C3.79208 12.9506 3.74701 14.4548 4.64577 15.3538C5.54452 16.2528 7.04876 16.2083 8.00213 15.2546L9.65633 13.5999'/>\n                </svg>\n              </Button>\n            </Show>\n            <Show when={state().options.toolbar.image}>\n              <Button onclick={() => formatAs(InkValues.Markup.Image)}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <rect x='2' y='4' width='16' height='12' rx='1'/>\n                  <path d='M7.42659 7.67597L13.7751 13.8831M2.00208 12.9778L7.42844 7.67175'/>\n                  <path d='M11.9119 12.0599L14.484 9.54443L17.9973 12.9785'/>\n                  <path d='M10.9989 7.95832C11.551 7.95832 11.9986 7.52072 11.9986 6.98092C11.9986 6.44113 11.551 6.00354 10.9989 6.00354C10.4468 6.00354 9.99921 6.44113 9.99921 6.98092C9.99921 7.52072 10.4468 7.95832 10.9989 7.95832Z'/>\n                </svg>\n              </Button>\n            </Show>\n            <Show when={state().options.toolbar.upload}>\n              <Button onclick={uploadClickHandler}>\n                <svg viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-miterlimit='5' stroke-linecap='round' stroke-linejoin='round'>\n                  <path d='M10 13V4M10 4L13 7M10 4L7 7'/>\n                  <path d='M2 13V15C2 15.5523 2.44772 16 3 16H17C17.5523 16 18 15.5523 18 15V13'/>\n                </svg>\n                <input style={{ display: 'none' }} type='file' onChange={uploadChangeHandler} ref={setUploader} />\n              </Button>\n            </Show>\n          </div>\n        </Show>\n      </div>\n    </div>\n  )\n}\n","import { type Component, createEffect, createSignal, onMount } from 'solid-js'\nimport { buildVendorUpdates } from '/src/extensions'\nimport { useStore } from '../../app'\nimport { makeVars } from '../../utils'\nimport styles from './styles.css?inline'\n\nexport const Styles: Component = () => {\n  const [state, setState] = useStore()\n  const [vars, setVars] = createSignal(makeVars(state()))\n\n  createEffect(() => {\n    setVars(makeVars(state()))\n  })\n\n  onMount(() => {\n    const mediaQueryList = window.matchMedia('(prefers-color-scheme: dark)')\n    const listener = (_event: MediaQueryListEvent) => {\n      const { editor, root, workQueue } = state()\n\n      if (root.isConnected) {\n        workQueue.enqueue(async () => {\n          const effects = await buildVendorUpdates([state, setState])\n\n          editor.dispatch({ effects })\n          setVars(makeVars(state()))\n        })\n      } else {\n        mediaQueryList.removeEventListener('change', listener)\n      }\n    }\n\n    mediaQueryList.addEventListener('change', listener)\n  })\n\n  return (\n    <style textContent={`.ink {\\n  ${vars().join('\\n  ')}\\n}\\n${styles}`} />\n  )\n}\n","import { Show } from 'solid-js'\nimport type { Component } from 'solid-js'\nimport { getHydrationMarkerProps } from '/src/constants'\nimport { override } from '/src/utils/merge'\nimport type InkInternal from '/types/internal'\nimport { useStore } from '../../app'\nimport { Details } from '../details'\nimport { DropZone } from '../drop_zone'\nimport { Editor } from '../editor'\nimport { Toolbar } from '../toolbar'\nimport { Styles } from './styles'\n\nexport const Root: Component<{ store: InkInternal.Store, target?: HTMLElement }> = (props) => {\n  const [state, setState] = useStore()\n  const setRoot = (root: HTMLElement) => {\n    setState(override(state(), { root }))\n  }\n\n  return (\n    <div class='ink ink-mde' ref={setRoot} {...getHydrationMarkerProps()}>\n      <Styles />\n      <Show when={state().options.files.clipboard || state().options.files.dragAndDrop}>\n        <DropZone />\n      </Show>\n      <Show when={state().options.interface.toolbar}>\n        <Toolbar />\n      </Show>\n      <div class='ink-mde-editor'>\n        <Editor target={props.target} />\n      </div>\n      <Show when={state().options.readability || state().options.interface.attribution}>\n        <Details store={[state, setState]} />\n      </Show>\n    </div>\n  )\n}\n","import { createContext, useContext } from 'solid-js'\nimport type { Component, JSX } from 'solid-js'\nimport type InkInternal from '/types/internal'\nimport { blankState } from '../store'\nimport { Root } from './components/root'\n\nconst AppContext = createContext<InkInternal.Store>([() => blankState(), value => (typeof value === 'function' ? value(blankState()) : value)])\nconst AppProvider: Component<{ children: JSX.Element, store: InkInternal.Store }> = (props) => {\n  return (\n    // eslint-disable-next-line solid/reactivity\n    <AppContext.Provider value={props.store}>\n      {props.children}\n    </AppContext.Provider>\n  )\n}\n\nexport const useStore = () => {\n  return useContext(AppContext)\n}\n\nexport const App: Component<{ store: InkInternal.Store, target?: HTMLElement }> = (props) => {\n  return (\n    <AppProvider store={props.store}>\n      <Root store={props.store} target={props.target} />\n    </AppProvider>\n  )\n}\n","import { hydrate as solidHydrate, render as solidRender, renderToString as solidRenderToString } from 'solid-js/web'\nimport { HYDRATION_MARKER_SELECTOR } from '/src/constants'\nimport { makeInstance } from '/src/instance'\nimport { makeStore } from '/src/store'\nimport { App } from '/src/ui/app'\nimport { isPromise } from '/src/utils/inspect'\nimport { type PluginValueForType } from '/src/utils/options'\nimport type * as Ink from '/types/ink'\n\nexport type * from '/types/ink'\nexport { appearanceTypes, pluginTypes } from '/types/values'\n\nexport const defineConfig = <T extends Ink.Options>(config: T) => config\nexport const defineOptions = <T extends Ink.Options>(options: T) => options\nexport const definePlugin = <T extends Ink.Options.RecursivePlugin>(plugin: T) => plugin\n\nexport const hydrate = (target: HTMLElement, options: Ink.Options = {}): Ink.AwaitableInstance => {\n  const store = makeStore(options)\n\n  if (!import.meta.env.VITE_SSR) {\n    solidPrepareForHydration()\n    solidHydrate(() => <App store={store} target={target} />, target)\n  }\n\n  return makeInstance(store)\n}\n\nexport const ink = (target: HTMLElement, options: Ink.Options = {}): Ink.AwaitableInstance => {\n  const hasHydrationMarker = !!target.querySelector(HYDRATION_MARKER_SELECTOR)\n\n  if (hasHydrationMarker) {\n    return hydrate(target, options)\n  }\n\n  return render(target, options)\n}\n\nexport const inkPlugin = <T extends Ink.Values.PluginType>({ key = '', type, value }: { key?: string, type?: T, value: () => PluginValueForType<T> }) => {\n  return new Proxy({ key, type: type || 'default' } as Ink.Options.Plugin, {\n    get: (target, prop: keyof Ink.Options.Plugin, _receiver) => {\n      if (prop === 'value' && !target[prop]) {\n        target.value = value()\n\n        if (isPromise(target.value)) {\n          return target.value.then(val => target.value = val)\n        }\n\n        return target.value\n      }\n\n      return target[prop]\n    },\n  })\n}\n\nexport const plugin = inkPlugin\n\nexport const render = (target: HTMLElement, options: Ink.Options = {}): Ink.AwaitableInstance => {\n  const store = makeStore(options)\n\n  if (!import.meta.env.VITE_SSR) {\n    solidRender(() => <App store={store} target={target} />, target)\n  }\n\n  return makeInstance(store)\n}\n\nexport const renderToString = (options: Ink.Options = {}): string => {\n  const store = makeStore(options)\n\n  // Needed for tree-shaking purposes.\n  if (!import.meta.env.VITE_SSR) {\n    return ''\n  }\n\n  return solidRenderToString(() => <App store={store} />)\n}\n\nexport const solidPrepareForHydration = () => {\n  // @ts-expect-error Todo: This is a third-party vendor script.\n  // eslint-disable-next-line\n  let e,t;e=window._$HY||(window._$HY={events:[],completed:new WeakSet,r:{}}),t=e=>e&&e.hasAttribute&&(e.hasAttribute(\"data-hk\")?e:t(e.host&&e.host instanceof Node?e.host:e.parentNode)),['click', 'input'].forEach((o=>document.addEventListener(o,(o=>{let s=o.composedPath&&o.composedPath()[0]||o.target,a=t(s);a&&!e.completed.has(a)&&e.events.push([a,o])})))),e.init=(t,o)=>{e.r[t]=[new Promise(((e,t)=>o=e)),o]},e.set=(t,o,s)=>{(s=e.r[t])&&s[1](o),e.r[t]=[o]},e.unset=t=>{delete e.r[t]},e.load=(t,o)=>{if(o=e.r[t])return o[0]}\n}\n\nexport const wrap = (textarea: HTMLTextAreaElement, options: Ink.Options = {}) => {\n  const replacement = <div class='ink-mde-textarea' /> as HTMLDivElement\n  const doc = textarea.value\n\n  textarea.after(replacement)\n  textarea.style.display = 'none'\n\n  const instance = render(replacement, { doc, ...options })\n\n  if (textarea.form) {\n    textarea.form.addEventListener('submit', () => {\n      textarea.value = instance.getDoc()\n    })\n  }\n\n  return instance\n}\n\nexport default ink\n","import { autocompletion, closeBrackets } from '@codemirror/autocomplete'\nimport { filterPlugins, partitionPlugins } from '/src/utils/options'\nimport type * as Ink from '/types/ink'\nimport { pluginTypes } from '/types/values'\n\nexport const autocomplete = (options: Ink.OptionsResolved) => {\n  // Todo: Handle lazy-loaded completions.\n  const [_lazyCompletions, completions] = partitionPlugins(filterPlugins(pluginTypes.completion, options))\n\n  return [\n    autocompletion({\n      defaultKeymap: true,\n      icons: false,\n      override: completions,\n      optionClass: () => 'ink-tooltip-option',\n    }),\n    closeBrackets(),\n  ]\n}\n","import { syntaxTree } from '@codemirror/language'\nimport type { EditorState, Extension, Range } from '@codemirror/state'\nimport { RangeSet, StateField } from '@codemirror/state'\nimport type { DecorationSet } from '@codemirror/view'\nimport { Decoration, EditorView, WidgetType } from '@codemirror/view'\n\ninterface ImageWidgetParams {\n  url: string,\n}\n\nclass ImageWidget extends WidgetType {\n  readonly url\n\n  constructor({ url }: ImageWidgetParams) {\n    super()\n\n    this.url = url\n  }\n\n  eq(imageWidget: ImageWidget) {\n    return imageWidget.url === this.url\n  }\n\n  toDOM() {\n    const container = document.createElement('div')\n    const backdrop = container.appendChild(document.createElement('div'))\n    const figure = backdrop.appendChild(document.createElement('figure'))\n    const image = figure.appendChild(document.createElement('img'))\n\n    container.setAttribute('aria-hidden', 'true')\n    container.className = 'cm-image-container'\n    backdrop.className = 'cm-image-backdrop'\n    figure.className = 'cm-image-figure'\n    image.className = 'cm-image-img'\n    image.src = this.url\n\n    container.style.paddingBottom = '0.5rem'\n    container.style.paddingTop = '0.5rem'\n\n    backdrop.classList.add('cm-image-backdrop')\n\n    backdrop.style.borderRadius = 'var(--ink-internal-border-radius)'\n    backdrop.style.display = 'flex'\n    backdrop.style.alignItems = 'center'\n    backdrop.style.justifyContent = 'center'\n    backdrop.style.overflow = 'hidden'\n    backdrop.style.maxWidth = '100%'\n\n    figure.style.margin = '0'\n\n    image.style.display = 'block'\n    image.style.maxHeight = 'var(--ink-internal-block-max-height)'\n    image.style.maxWidth = '100%'\n    image.style.width = '100%'\n\n    return container\n  }\n}\n\nexport const images = (): Extension => {\n  const imageRegex = /!\\[.*?\\]\\((?<url>.*?)\\)/\n\n  const imageDecoration = (imageWidgetParams: ImageWidgetParams) => Decoration.widget({\n    widget: new ImageWidget(imageWidgetParams),\n    side: -1,\n    block: true,\n  })\n\n  const decorate = (state: EditorState) => {\n    const widgets: Range<Decoration>[] = []\n\n    syntaxTree(state).iterate({\n      enter: ({ type, from, to }) => {\n        if (type.name === 'Image') {\n          const result = imageRegex.exec(state.doc.sliceString(from, to))\n\n          if (result && result.groups && result.groups.url)\n            widgets.push(imageDecoration({ url: result.groups.url }).range(state.doc.lineAt(from).from))\n        }\n      },\n    })\n\n    return widgets.length > 0 ? RangeSet.of(widgets) : Decoration.none\n  }\n\n  const imagesField = StateField.define<DecorationSet>({\n    create(state) {\n      return decorate(state)\n    },\n    update(images, transaction) {\n      if (transaction.docChanged)\n        return decorate(transaction.state)\n\n      return images.map(transaction.changes)\n    },\n    provide(field) {\n      return EditorView.decorations.from(field)\n    },\n  })\n\n  return [\n    imagesField,\n  ]\n}\n","import { indentLess, indentMore } from '@codemirror/commands'\nimport { type Extension } from '@codemirror/state'\nimport { keymap } from '@codemirror/view'\n\nexport const indentWithTab = ({ tab = true, shiftTab = true } = {}): Extension => {\n  return keymap.of([\n    {\n      key: 'Tab',\n      run: tab ? indentMore : undefined,\n    },\n    {\n      key: 'Shift-Tab',\n      run: shiftTab ? indentLess : undefined,\n    },\n  ])\n}\n","import { syntaxTree } from '@codemirror/language'\nimport { RangeSet, StateField } from '@codemirror/state'\nimport type { EditorState, Extension, Range } from '@codemirror/state'\nimport { Decoration, EditorView, ViewPlugin } from '@codemirror/view'\nimport type { DecorationSet } from '@codemirror/view'\nimport { buildWidget } from '/lib/codemirror-kit'\n\nconst dotWidget = () => buildWidget({\n  eq: () => {\n    return false\n  },\n  toDOM: () => {\n    const span = document.createElement('span')\n\n    span.innerHTML = '&#x2022;'\n    span.setAttribute('aria-hidden', 'true')\n\n    return span\n  },\n})\n\nconst taskWidget = (isChecked: boolean) => buildWidget({\n  eq: (other) => {\n    return other.isChecked === isChecked\n  },\n  ignoreEvent: () => false,\n  isChecked,\n  toDOM: () => {\n    const input = document.createElement('input')\n\n    input.setAttribute('aria-hidden', 'true')\n    input.className = 'ink-mde-task-toggle'\n    input.type = 'checkbox'\n    input.checked = isChecked\n\n    return input\n  },\n})\n\nconst hasOverlap = (x1: number, x2: number, y1: number, y2: number) => {\n  return Math.max(x1, y1) <= Math.min(x2, y2)\n}\n\nconst isCursorInRange = (state: EditorState, from: number, to: number) => {\n  return state.selection.ranges.some((range) => {\n    return hasOverlap(from, to, range.from, range.to)\n  })\n}\n\nconst toggleTask = (view: EditorView, position: number) => {\n  const before = view.state.sliceDoc(position + 2, position + 5)\n\n  view.dispatch({\n    changes: {\n      from: position + 2,\n      to: position + 5,\n      insert: before === '[ ]' ? '[x]' : '[ ]',\n    },\n  })\n\n  return true\n}\n\nexport const lists = (): Extension => {\n  const dotDecoration = () => Decoration.replace({\n    widget: dotWidget(),\n  })\n\n  const taskDecoration = (isChecked: boolean) => Decoration.replace({\n    widget: taskWidget(isChecked),\n  })\n\n  const decorate = (state: EditorState) => {\n    const widgets: Range<Decoration>[] = []\n\n    syntaxTree(state).iterate({\n      enter: ({ type, from, to }) => {\n        if (type.name === 'ListMark' && !isCursorInRange(state, from, to)) {\n          const task = state.sliceDoc(to + 1, to + 4)\n\n          if (!['[ ]', '[x]'].includes(task)) {\n            const marker = state.sliceDoc(from, to)\n\n            if (['-', '*'].includes(marker)) {\n              widgets.push(dotDecoration().range(from, to))\n            }\n          }\n        }\n\n        if (type.name === 'TaskMarker' && !isCursorInRange(state, from - 2, to)) {\n          const task = state.sliceDoc(from, to)\n\n          widgets.push(taskDecoration(task === '[x]').range(from - 2, to))\n        }\n      },\n    })\n\n    return widgets.length > 0 ? RangeSet.of(widgets) : Decoration.none\n  }\n\n  const viewPlugin = ViewPlugin.define(() => ({}), {\n    eventHandlers: {\n      mousedown: (event, view) => {\n        const target = event.target as HTMLElement\n\n        if (target?.nodeName === 'INPUT' && target.classList.contains('ink-mde-task-toggle')) {\n          return toggleTask(view, view.posAtDOM(target))\n        }\n      },\n    },\n  })\n  const stateField = StateField.define<DecorationSet>({\n    create(state) {\n      return decorate(state)\n    },\n    update(_references, { state }) {\n      return decorate(state)\n    },\n    provide(field) {\n      return EditorView.decorations.from(field)\n    },\n  })\n\n  return [\n    viewPlugin,\n    stateField,\n  ]\n}\n","import { EditorState } from '@codemirror/state'\n\nexport const readonly = () => {\n  return EditorState.readOnly.of(true)\n}\n","import { SearchQuery, findNext, findPrevious, getSearchQuery, search as searchExtension, searchKeymap, setSearchQuery } from '@codemirror/search'\nimport { keymap, runScopeHandlers } from '@codemirror/view'\nimport { createRoot, createSignal } from 'solid-js'\n\nexport const search = () => {\n  return [\n    searchExtension({\n      top: true,\n      createPanel: (view) => {\n        return createRoot((dispose) => {\n          const [query, setQuery] = createSignal(getSearchQuery(view.state))\n          let el: HTMLInputElement | undefined\n\n          const handleKeyDown = (event: KeyboardEvent) => {\n            if (runScopeHandlers(view, event, 'search-panel')) return event.preventDefault()\n\n            if (event.code === 'Enter') {\n              event.preventDefault()\n\n              if (event.shiftKey) {\n                findPrevious(view)\n              } else {\n                findNext(view)\n              }\n            }\n          }\n\n          const updateSearch = (event: InputEvent) => {\n            // @ts-expect-error \"value\" is not a recognized property of EventTarget.\n            const { value } = event.target\n\n            setQuery(new SearchQuery({ search: value }))\n            view.dispatch({ effects: setSearchQuery.of(query()) })\n          }\n\n          return {\n            destroy: () => {\n              dispose()\n            },\n            dom: (\n              <div class='ink-mde-search-panel' onKeyDown={handleKeyDown}>\n                <input attr:main-field='true' class='ink-mde-search-input' onInput={updateSearch} onKeyDown={handleKeyDown} ref={el} type=\"text\" value={query().search} />\n              </div>\n            ) as HTMLElement,\n            mount: () => {\n              el?.focus()\n            },\n            top: true,\n          }\n        })\n      },\n    }),\n    keymap.of(searchKeymap),\n  ]\n}\n","import type { Extension } from '@codemirror/state'\nimport { EditorView } from '@codemirror/view'\n\nexport const spellcheck = (): Extension => {\n  return EditorView.contentAttributes.of({\n    spellcheck: 'true',\n  })\n}\n","export type Katex = Awaited<ReturnType<typeof importer>>\n\nexport const importer = async () => {\n  const { default: katex } = await import('katex')\n\n  return katex\n}\n"],"names":["HYDRATION_MARKER","HYDRATION_MARKER_SELECTOR","getHydrationMarkerProps","destroy","state","editor","focus","toCodeMirror","selections","ranges","selection","SelectionRange","EditorSelection","toInk","range","Appearance","Markup","Selection","appearanceTypes","pluginTypes","defineConfig","overrides","formatting","InkValues.Markup","splitSelectionByLines","position","line","start","end","getSelection","formatDefinition","initialSelection","getText","changeDetails","getNode","definition","getNodes","type","nodeDefinitions","syntaxTree","from","to","unformat","text","sliceStart","sliceEnd","unformatted","formatBlock","before","after","formatMultiline","changes","lineChanges","formatLine","hasPrefixStates","prefixState","prefix","prefixStateIndex","nextPrefixState","updatedText","formatInline","getChanges","format","formatType","maybeSelection","cursorPosition","updates","node","offset","total","change","getDoc","insert","setState","updateSelection","current","anchor","head","types","getType","object","is","deepAssign","target","source","seen","assign","replacement","key","override","a","b","objectTypes","isPromise","partitionPlugins","plugins","partition","isPlugin","pluginType","plugin","isOptionsKey","options","filterPlugins","flatten","matches","array","flatArray","item","isValid","partitions","entry","makeExtension","baseExtensions","lazyExtensions","extensions","filterExtensions","lazyLanguages","languages","filterLanguages","effects","buildVendorUpdates","markdownExtension","markdownLanguage","baseLanguages","updateExtension","markdown","compartment","Compartment","store","createElement","isAutoDark","isDark","appearance","InkValues.Appearance","makeVars","styles","isLight","style","value","EditorView","buildVendors","e","extension","resolver","lazyExtension","reconfigure","createExtensions","resolvers","r","lazyResolvers","_lazyExtensions","isAuto","autocomplete","images","keybindings","trapTab","tab","shiftTab","indentWithTab","lists","placeholder","readonly","search","spellcheck","vim","blockquoteSyntaxNodes","blockquoteDecoration","Decoration","blockquoteOpenDecoration","blockquoteCloseDecoration","blockquotePlugin","ViewPlugin","view","decorate","builder","RangeSetBuilder","tree","visibleRange","openLine","closeLine","blockquote","codeBlockSyntaxNodes","sharedAttributes","codeBlockDecoration","codeBlockOpenDecoration","codeBlockCloseDecoration","codeDecoration","codeOpenDecoration","codeCloseDecoration","codeBlockPlugin","inlineCode","code","inkClassExtensions","ink","lineWrapping","theme","syntaxHighlighting","HighlightStyle","tags","toVendorSelection","makeState","EditorState","history","keymap","defaultKeymap","historyKeymap","load","doc","workQueue","select","selectMultiple","selectOne","selectAt","at","InkValues.Selection","update","wrap","userSelection","awaitable","initialValue","handler","callback","settler","resolve","reject","settledValue","error","then","onFulfilled","onRejected","onSettled","makeInstance","instance","buildBlockWidgetDecoration","buildWidgetDecoration","buildLineDecoration","buildMarkDecoration","buildWidget","eq","other","buildNodeDecorations","decorationRanges","maybeDecorations","decoration","wrapped","left","right","buildOptimizedNodeDecorations","rangeSet","transaction","decorations","cursor","cursors","cursorsToSkip","_beforeFrom","_beforeTo","changeFrom","changeTo","nodeLength","cursorFrom","cursorTo","isOverlapping","cursorDecos","x1","x2","y1","y2","nodeDecorator","StateField","RangeSet","updatedRangeSet","field","buildTag","parent","Tag","getCharCode","char","buildMarkNode","markName","buildTaggedNode","nodeName","styleTags","tag","defineNode","defineBlockParser","defineInlineParser","defineMarkdown","modules","prop","_receiver","importer","__variableDynamicImportRuntimeHelper","imported","useModule","name","charCodes","mathInlineTestRegex","mathInlineCaptureRegex","mathInline","mathInlineMark","mathInlineMarkOpen","mathInlineMarkClose","mathInlineParser","inlineContext","nextCharCode","remainingLineText","match","mathExpressionLength","mathBlock","mathBlockMark","mathBlockMarkOpen","mathBlockMarkClose","mathBlockParser","blockContext","openLineStart","openLineEnd","closeLineStart","closeLineEnd","grammar","render","element","katex","_state","classes","container","block","dom","katexTarget","makeQueue","process","task","blankState","partialState","makeStore","createSignal","DEFAULT_WORDS_PER_MINUTE","toHuman","wordsPerMinute","readTime","toHumanReadTime","wordCount","toHumanWordCount","lineCount","toHumanLineCount","charCount","toHumanCharCount","toCharCount","toLineCount","toReadTime","readTimeMinutes","readTimeSeconds","toWordCount","scrubbed","Details","useStore","_el$","_$getNextElement","_tmpl$4","_el$2","firstChild","_el$3","_el$8","_el$9","_co$","_$getNextMarker","nextSibling","_el$10","_el$11","_co$2","_el$12","_el$13","_co$3","_$insert","_$createComponent","Show","when","readability","children","_el$4","_tmpl$","_el$5","_$memo","interface","attribution","_tmpl$2","_tmpl$3","DropZone","depth","setDepth","files","setFiles","isLoading","setIsLoading","isVisible","setIsVisible","closeModal","dropOnZone","event","dragAndDrop","preventDefault","stopPropagation","transfer","dataTransfer","uploadFiles","onDragEnter","onDragLeave","onDragOver","onDrop","onPaste","clipboard","clipboardData","length","userFiles","Array","forEach","file","Promise","url","injectMarkup","markup","finally","onMount","document","addEventListener","root","onCleanup","removeEventListener","_el$7","_$setProperty","For","each","slice","_$effect","_p$","_v$","_v$2","URL","createObjectURL","_$setAttribute","undefined","fallback","$$click","classList","toggle","_$runHydrationEvents","_$delegateEvents","makeEditor","rootNode","newDoc","Editor","props","enqueue","dispatch","Button","onclick","Toolbar","uploader","setUploader","formatAs","uploadChangeHandler","uploadClickHandler","click","_tmpl$15","_el$45","_el$46","_co$13","_el$47","_el$48","_co$14","_el$49","_el$50","_co$15","_el$51","_el$52","_co$16","toolbar","heading","bold","italic","InkValues","Heading","Bold","Italic","quote","codeBlock","_el$14","_el$18","_el$19","_co$4","_el$20","_el$21","_co$5","_el$22","_el$23","_co$6","Quote","_tmpl$5","CodeBlock","_tmpl$6","Code","_tmpl$7","list","orderedList","taskList","_el$24","_el$28","_el$29","_co$7","_el$30","_el$31","_co$8","_el$32","_el$33","_co$9","List","_tmpl$8","OrderedList","_tmpl$9","TaskList","_tmpl$10","link","image","upload","_el$34","_el$39","_el$40","_co$10","_el$41","_el$42","_co$11","_el$43","_el$44","_co$12","Link","_tmpl$11","Image","_tmpl$12","_tmpl$13","_el$38","_tmpl$14","_$use","setProperty","Styles","vars","setVars","createEffect","mediaQueryList","window","matchMedia","listener","_event","isConnected","join","Root","setRoot","_el$6","_$spread","_$mergeProps","AppContext","createContext","AppProvider","Provider","useContext","App","config","defineOptions","definePlugin","hydrate","solidPrepareForHydration","solidHydrate","querySelector","inkPlugin","Proxy","get","val","solidRender","renderToString","t","_$HY","events","completed","WeakSet","hasAttribute","host","Node","parentNode","o","s","composedPath","has","push","init","set","unset","textarea","display","form","_lazyCompletions","completions","autocompletion","closeBrackets","ImageWidget","WidgetType","imageWidget","backdrop","figure","imageRegex","imageDecoration","imageWidgetParams","widgets","result","indentMore","indentLess","dotWidget","span","taskWidget","isChecked","input","hasOverlap","isCursorInRange","toggleTask","dotDecoration","taskDecoration","marker","viewPlugin","stateField","_references","searchExtension","top","createPanel","createRoot","dispose","query","setQuery","getSearchQuery","el","handleKeyDown","runScopeHandlers","shiftKey","findPrevious","findNext","updateSearch","SearchQuery","setSearchQuery","of","$$keydown","_ref$","$$input","mount","searchKeymap"],"mappings":"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"}